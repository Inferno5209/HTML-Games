<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Reservations - Crystal Acres Resorts</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
    <!-- Vertical Sidebar Navigation -->
    <nav class="sidebar-nav">
        <div class="sidebar-logo" style="position: relative;">
            <img src="icon.png" alt="Crystal Acres Logo" style="cursor: pointer;">
            <!-- Decoy clickable area (does nothing) -->
            <div onclick="void(0)" style="position: absolute; left: 0; top: 0; width: 100%; height: 100%; cursor: pointer; z-index: 1001;"></div>
            <!-- Hidden Admin Button Over Middle Tree (actual sweet spot) -->
            <button id="hiddenAdminBtn" onclick="toggleAdminMode()" style="position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 30px; height: 30px; background: transparent; border: none; cursor: pointer; z-index: 1002; opacity: 0;">
            </button>
        </div>
        <ul class="nav-menu" id="sidebarNavMenu">
            <li><a href="index.html" class="nav-link">Home</a></li>
            <li><a href="index.html#general-info" class="nav-link">General Information</a></li>
            <li><a href="index.html#things-to-do" class="nav-link">Things to Do</a></li>
            <li><a href="index.html#history" class="nav-link">History</a></li>
            <li><a href="index.html#cottages" class="nav-link">The Cottages</a></li>
            <li><a href="index.html#contact" class="nav-link">Contact</a></li>
        </ul>
    </nav>

    <!-- Top Navigation Bar -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <!-- Pine Trees Decoration -->
            <div style="position: absolute; left: 48%; transform: translateX(-50%); font-size: 1.5rem; opacity: 0.7; white-space: nowrap; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); pointer-events: none; letter-spacing: 8px;">
                üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤  üå≤
            </div>
            
            <!-- Admin Controls -->
            <div style="position: absolute; right: 20px; display: flex; gap: 10px; align-items: center; z-index: 1001;">
                <!-- Admin Toggle Button -->
                <button id="adminToggleBtn" onclick="toggleAdminMode()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease; position: relative; overflow: hidden;">
                    <span style="position: relative; z-index: 1; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 18px;">üîí</span>
                        <span>Admin</span>
                    </span>
                </button>
                
                <!-- Admin Tools Dropdown -->
                <div style="position: relative;">
                    <button id="adminToolsBtn" onclick="toggleAdminDropdown()" style="display: none; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 15px; font-weight: 600; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4); transition: all 0.3s ease; position: relative; overflow: hidden;">
                        <span style="position: relative; z-index: 1; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">‚öôÔ∏è</span>
                            <span>Admin Tools</span>
                        </span>
                    </button>
                    <div id="adminDropdown" style="display: none; position: absolute; top: 100%; right: 0; margin-top: 8px; background: white; border: none; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); min-width: 260px; z-index: 10000; overflow: hidden; backdrop-filter: blur(10px);">
                        <button onclick="openAdminManager(); toggleAdminDropdown();" style="width: 100%; background: white; color: #333; border: none; padding: 16px 20px; text-align: left; cursor: pointer; font-size: 15px; font-weight: 600; border-bottom: 1px solid #f0f0f0; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.color='white'; this.style.transform='translateX(5px)';" onmouseout="this.style.background='white'; this.style.color='#333'; this.style.transform='translateX(0)';">
                            <span style="font-size: 20px; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; transition: all 0.3s ease;">üë§</span>
                            <span>Admin Manager</span>
                        </button>
                        <button onclick="openReservationManager(); toggleAdminDropdown();" style="width: 100%; background: white; color: #333; border: none; padding: 16px 20px; text-align: left; cursor: pointer; font-size: 15px; font-weight: 600; border-bottom: 1px solid #f0f0f0; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.background='linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'; this.style.color='white'; this.style.transform='translateX(5px)';" onmouseout="this.style.background='white'; this.style.color='#333'; this.style.transform='translateX(0)';">
                            <span style="font-size: 20px; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 8px; transition: all 0.3s ease;">üìÖ</span>
                            <span>Reservation Manager</span>
                        </button>
                        <button onclick="toggleMaintenanceMode(); toggleAdminDropdown();" id="maintenanceModeBtn" style="width: 100%; background: white; color: #333; border: none; padding: 16px 20px; text-align: left; cursor: pointer; font-size: 15px; font-weight: 600; border-radius: 0 0 12px 12px; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px;" onmouseover="this.style.background='linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'; this.style.color='white'; this.style.transform='translateX(5px)';" onmouseout="this.style.background='white'; this.style.color='#333'; this.style.transform='translateX(0)';">
                            <span style="font-size: 20px; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 8px; transition: all 0.3s ease;">üöß</span>
                            <div style="display: flex; flex-direction: column; gap: 2px;">
                                <span>Maintenance Mode</span>
                                <span style="font-size: 12px; font-weight: 500; opacity: 0.8;"><span id="maintenanceStatus">OFF</span></span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Maintenance Mode Overlay -->
    <div id="maintenanceOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index: 999;">
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;">
            <div style="text-align: center; color: white; max-width: 600px;">
                <div style="font-size: 100px; margin-bottom: 30px; animation: bounce 2s infinite;">&#128679;</div>
                <h1 style="font-size: 48px; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">Website Under Maintenance</h1>
                <p style="font-size: 24px; margin-bottom: 30px; line-height: 1.6;">We're currently performing scheduled maintenance to improve your experience.</p>
                <p style="font-size: 18px; opacity: 0.9;">Please check back shortly. We apologize for any inconvenience.</p>
                <div style="margin-top: 50px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; backdrop-filter: blur(10px);">
                    <p style="font-size: 16px; margin: 0;">For urgent inquiries, please contact us at:</p>
                    <p style="font-size: 20px; font-weight: bold; margin: 10px 0 0 0;">crystalacresnh@gmail.com</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Reservations Section -->
    <section class="booking-form-section" style="padding-top: 120px; min-height: 100vh;">
        <div class="container">
            <div class="booking-header">
                <h1>Reservations</h1>
                <p>Manage your reservations and bookings for Crystal Acres cottages</p>
                <!-- Back to Cottages Button -->
                <div style="margin-top: 20px;">
                    <a href="index.html#cottages" style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #2c5f7d 0%, #4a8fb5 100%); color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 1rem; box-shadow: 0 4px 15px rgba(44, 95, 125, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(44, 95, 125, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(44, 95, 125, 0.3)';">
                        <span>‚Üê</span>
                        <span>Back to Cottages</span>
                    </a>
                </div>
            </div>

            <!-- Select Cottage Section -->
            <div id="cottageSelectionSection" style="background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1); margin-top: 40px;">
                <h2 style="color: var(--primary-color); margin-bottom: 20px; text-align: center; font-size: 2rem;">Select Your Cottage(s)</h2>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 30px; font-size: 1.1rem;">Choose one or more cottages for your stay at Crystal Acres</p>
                
                <!-- Seasonal Pricing Info -->
                <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 15px 0; color: #333; text-align: center; font-size: 1.2rem;">üìÖ Seasonal Pricing</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; text-align: center;">
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 700; color: #4facfe; margin-bottom: 5px;">üå∏ Spring</div>
                            <div style="font-size: 0.9rem; color: #666;">Mar 1 - May 31</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 700; color: #11998e; margin-bottom: 5px;">‚òÄÔ∏è Summer</div>
                            <div style="font-size: 0.9rem; color: #666;">Jun 1 - Aug 31</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 700; color: #fa709a; margin-bottom: 5px;">üçÇ Fall</div>
                            <div style="font-size: 0.9rem; color: #666;">Sep 1 - Nov 30</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px;">
                            <div style="font-weight: 700; color: #667eea; margin-bottom: 5px;">‚ùÑÔ∏è Winter</div>
                            <div style="font-size: 0.9rem; color: #666;">Dec 1 - Feb 28/29</div>
                        </div>
                    </div>
                </div>
                
                <div class="cottages-grid">
                    <!-- The Villa -->
                    <div class="cottage-compact-card cottage-selectable" id="cottage-villa" style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="cottage-compact-image">
                            <img src="villa/main.jpg" alt="The Villa - Living Room">
                        </div>
                        <div class="cottage-compact-content">
                            <h3>The Villa</h3>
                            <p class="cottage-capacity">Sleeps 6 | 2 Bedrooms | 1 Bathroom</p>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center;">
                                <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                                <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $175 | ‚òÄÔ∏è $225<br>üçÇ $175 | ‚ùÑÔ∏è $150</div>
                            </div>
                            <p class="cottage-summary">This cozy cottage has the best view of the lake and lots of convenient amenities. Features screened porch, fireplace, fully equipped kitchen, washer/dryer, and Internet TV.</p>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn btn-book cottage-select-btn" onclick="toggleCottageSelection(this, 'The Villa', 6, 2, {spring: 175, summer: 225, fall: 175, winter: 150})" style="width: 100%; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);">‚úó Select Cottage</button>
                            </div>
                        </div>
                    </div>

                    <!-- The Brown Camp -->
                    <div class="cottage-compact-card cottage-selectable" id="cottage-browncamp" style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="cottage-compact-image">
                            <img src="browncamp/main.jpg" alt="The Brown Camp - Living Room">
                        </div>
                        <div class="cottage-compact-content">
                            <h3>The Brown Camp</h3>
                            <p class="cottage-capacity">Sleeps 7 | 3 Bedrooms | 1 Bathroom</p>
                            <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center;">
                                <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                                <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $200 | ‚òÄÔ∏è $250<br>üçÇ $200 | ‚ùÑÔ∏è $175</div>
                            </div>
                            <p class="cottage-summary">A spacious cottage with 3 bedrooms, living room, and porch for eating and lounging. Named after Brown University‚Äîyes, even though all our cottages are brown!</p>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn btn-book cottage-select-btn" onclick="toggleCottageSelection(this, 'The Brown Camp', 7, 3, {spring: 200, summer: 250, fall: 200, winter: 175})" style="width: 100%; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);">‚úó Select Cottage</button>
                            </div>
                        </div>
                    </div>

                    <!-- The Shanty -->
                    <div class="cottage-compact-card cottage-selectable" id="cottage-shanty" style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="cottage-compact-image">
                            <img src="shanty/main.jpg" alt="The Shanty - Living Room">
                        </div>
                        <div class="cottage-compact-content">
                            <h3>The Shanty</h3>
                            <p class="cottage-capacity">Sleeps 6 | 2 Bedrooms | 1 Bathroom</p>
                            <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center;">
                                <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                                <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $175 | ‚òÄÔ∏è $225<br>üçÇ $175 | ‚ùÑÔ∏è $150</div>
                            </div>
                            <p class="cottage-summary">Set back from the others, the Shanty is a cute, rustic getaway and a family favorite with an inviting porch for eating or relaxing. Features screened porches and fireplace.</p>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn btn-book cottage-select-btn" onclick="toggleCottageSelection(this, 'The Shanty', 6, 2, {spring: 175, summer: 225, fall: 175, winter: 150})" style="width: 100%; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);">‚úó Select Cottage</button>
                            </div>
                        </div>
                    </div>

                    <!-- The Bunkhouse -->
                    <div class="cottage-compact-card cottage-selectable" id="cottage-bunkhouse" style="cursor: pointer; transition: all 0.3s ease;">
                        <div class="cottage-compact-image">
                            <img src="bunkhouse/main.jpg" alt="The Bunkhouse - Interior">
                        </div>
                        <div class="cottage-compact-content">
                            <h3>The Bunkhouse</h3>
                            <p class="cottage-capacity">Sleeps 4 | Add-On Only</p>
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px; margin: 10px 0; text-align: center;">
                                <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night (Add-On)</div>
                                <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $75 | ‚òÄÔ∏è $100<br>üçÇ $75 | ‚ùÑÔ∏è $60</div>
                            </div>
                            <p class="cottage-summary">Built in 1936 with historic signatures from the 1930s still on the walls. Perfect for kids and teens. Can only be rented as an add-on to main cottages.</p>
                            <div style="text-align: center; margin-top: 15px;">
                                <button class="btn btn-book cottage-select-btn" onclick="toggleCottageSelection(this, 'The Bunkhouse', 4, 1, {spring: 75, summer: 100, fall: 75, winter: 60})" style="width: 100%; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);">‚úó Select Cottage</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Continue to Booking Button -->
                <div id="continueBookingSection" style="display: none; margin-top: 40px; text-align: center; padding: 30px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px;">
                    <div id="selectedCottagesSummary" style="margin-bottom: 20px; font-size: 1.1rem; color: #333;"></div>
                    <button onclick="showGuestSelection()" class="btn btn-book-large" style="display: inline-block; padding: 15px 50px;">
                        Continue to Guest Details ‚Üí
                    </button>
                </div>
            </div>

            <!-- Guest Details & Information Section -->
            <div id="guestSection" style="display: none; background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1); margin-top: 40px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 style="color: var(--primary-color); margin: 0; font-size: 2rem;">Reservation Details</h2>
                    <button onclick="backToCottageSelection()" class="btn btn-secondary" style="background: #95a5a6; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Cottages
                    </button>
                </div>

                <!-- Selected Cottages Display -->
                <div id="guestCottagesSummary" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;"></div>

                <!-- Guest Information Form -->
                <form id="guestDetailsForm" onsubmit="return false;">
                    <!-- Personal Information -->
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                        <h3 style="color: #333; margin: 0 0 20px 0; font-size: 1.3rem;">Personal Information</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">First Name <span style="color: red;">*</span></label>
                                <input type="text" id="firstName" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Last Name <span style="color: red;">*</span></label>
                                <input type="text" id="lastName" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Email Address <span style="color: red;">*</span></label>
                                <input type="email" id="email" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Phone Number <span style="color: red;">*</span></label>
                                <input type="tel" id="phone" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                        </div>
                    </div>

                    <!-- Guest Count & Pricing -->
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                        <h3 style="color: #333; margin: 0 0 20px 0; font-size: 1.3rem;">Guest Details</h3>
                        
                        <div style="background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                            <strong>üë• Guest Pricing (Per Night):</strong>
                            <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                                <li><strong>Adults:</strong> $30/night per person</li>
                                <li><strong>Children:</strong> $15/night per child</li>
                                <li><strong>Pets:</strong> $20/night per pet</li>
                            </ul>
                        </div>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Number of Adults <span style="color: red;">*</span></label>
                                <input type="number" id="numAdults" min="1" value="2" required onchange="updateGuestPricing()" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Number of Children</label>
                                <input type="number" id="numChildren" min="0" value="0" onchange="updateGuestPricing()" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; color: #333; margin-bottom: 8px;">Number of Pets</label>
                                <input type="number" id="numPets" min="0" value="0" onchange="updateGuestPricing()" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                            </div>
                        </div>

                        <!-- Guest Pricing Estimate -->
                        <div id="guestPricingEstimate" style="padding: 20px; background: white; border-radius: 10px; border: 2px solid #4facfe;">
                            <div style="font-size: 1.1rem; font-weight: 600; color: #333; margin-bottom: 10px;">Daily Guest Charges:</div>
                            <div id="guestPriceBreakdown" style="color: #666; line-height: 1.8;"></div>
                            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #eee; font-size: 1.2rem; font-weight: 700; color: var(--primary-color);">
                                Per Night: <span id="guestTotalPerNight">$0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Special Requests -->
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin-bottom: 30px;">
                        <h3 style="color: #333; margin: 0 0 20px 0; font-size: 1.3rem;">Special Requests (Optional)</h3>
                        <textarea id="specialNotes" rows="4" placeholder="Any special requests or notes for your reservation..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical;"></textarea>
                    </div>
                </form>

                <!-- Continue Button -->
                <div style="text-align: center;">
                    <button onclick="proceedToCalendar()" class="btn btn-book-large" style="padding: 15px 50px; font-size: 1.1rem;">
                        Continue to Date Selection ‚Üí
                    </button>
                </div>
            </div>

            <!-- Availability Calendar Section -->
            <div id="calendarSection" style="display: none; background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1); margin-top: 40px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2 style="color: var(--primary-color); margin: 0; font-size: 2rem;">Select Your Dates</h2>
                    <button onclick="backToCottageSelection()" class="btn btn-secondary" style="background: #95a5a6; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        ‚Üê Back to Cottages
                    </button>
                </div>

                <!-- Selected Cottages Display -->
                <div id="calendarCottagesSummary" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px;"></div>

                <!-- Date Selection Info -->
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
                    <strong>üìÖ How to select dates:</strong>
                    <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                        <li><strong>Range Fill:</strong> Click a start date, then click an end date to fill all dates in between</li>
                        <li><strong>Remove Dates:</strong> Click any selected date to remove it from your selection</li>
                        <li>Red dates are already booked and cannot be selected</li>
                        <li>Click "Clear Selection" to start over</li>
                    </ul>
                </div>

                <!-- Calendar Controls -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="previousMonth()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            ‚Üê Previous
                        </button>
                        <button onclick="nextMonth()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            Next ‚Üí
                        </button>
                    </div>
                    <h3 id="calendarMonthYear" style="margin: 0; color: var(--primary-color); font-size: 1.5rem;"></h3>
                    <button onclick="clearDateSelection()" style="background: #ee0979; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        Clear Selection
                    </button>
                </div>

                <!-- Legend -->
                <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; font-size: 0.9rem;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: white; border: 2px solid #ddd; border-radius: 4px;"></div>
                        <span>Available</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 4px;"></div>
                        <span>Full Day</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(to right, rgba(79, 172, 254, 0.4) 0%, rgba(79, 172, 254, 0.4) 50%, #4facfe 50%, #00f2fe 100%); border-radius: 4px;"></div>
                        <span>Arrival (Half)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(to right, #4facfe 0%, #00f2fe 50%, rgba(0, 242, 254, 0.4) 50%, rgba(0, 242, 254, 0.4) 100%); border-radius: 4px;"></div>
                        <span>Departure (Half)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); border-radius: 4px;"></div>
                        <span>Booked</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 20px; height: 20px; background: #e0e0e0; border-radius: 4px;"></div>
                        <span>Past Date</span>
                    </div>
                </div>

                <!-- Calendar Grid -->
                <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-bottom: 30px;"></div>

                <!-- Selected Date Range Display -->
                <div id="selectedDatesDisplay" style="display: none; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 10px;">Selected Dates</div>
                    <div id="selectedDatesText" style="font-size: 1.1rem;"></div>
                    <div id="selectedNights" style="font-size: 0.95rem; margin-top: 10px; opacity: 0.95;"></div>
                </div>

                <!-- Price Estimate -->
                <div id="calendarPriceEstimate" style="display: none; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px; border-radius: 12px; text-align: center; margin-bottom: 30px;">
                    <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.3rem;">Estimated Total</h3>
                    <div id="calendarPriceBreakdown" style="font-size: 1.1rem; color: #666; margin-bottom: 15px;"></div>
                    <div id="calendarTotalPrice" style="font-size: 2.5rem; font-weight: 700; color: var(--primary-color);"></div>
                    <div style="font-size: 0.9rem; color: #666; margin-top: 10px; font-style: italic;">* Final price may vary based on specific dates and any additional fees</div>
                </div>

                <!-- Multiple Cottages Date Option (Only shown when multiple cottages selected) -->
                <div id="multipleCottagesOption" style="display: none;"></div>

                <!-- Individual Cottage Navigation (shown only in individual mode) -->
                <div id="individualCottageNav" style="display: none; margin-bottom: 20px; gap: 15px; justify-content: center; flex-wrap: wrap; align-items: center;">
                    <button id="prevCottageBtn" onclick="previousCottage()" style="background: #95a5a6; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease;">
                        ‚Üê Previous Cottage
                    </button>
                    <button id="clearCottageDatesBtn" onclick="clearCurrentCottageDates()" style="display: none; background: #e74c3c; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: all 0.3s ease;">
                        üóëÔ∏è Clear Dates
                    </button>
                    <button id="nextCottageBtn" onclick="saveAndNextCottage()" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);">
                        Next Cottage ‚Üí
                    </button>
                </div>

                <!-- Continue Button -->
                <div style="text-align: center;">
                    <button id="continueToBookingBtn" onclick="proceedToBooking()" disabled style="background: #95a5a6; color: white; border: none; padding: 15px 50px; border-radius: 8px; cursor: not-allowed; font-size: 1.1rem; font-weight: 600; transition: all 0.3s ease;">
                        Review Reservation
                    </button>
                </div>
            </div>

            <!-- Hidden Reservations List (Admin Only) -->
            <div id="adminReservationsList" style="display: none; margin-top: 60px;">
                <div style="background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1);">
                    <h2 style="color: var(--primary-color); margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 2rem;">üìã</span>
                        All Reservations
                    </h2>
                    <div id="reservationsList">
                        <!-- Reservations will be loaded here by JavaScript -->
                        <p style="text-align: center; color: var(--text-light); padding: 40px; font-style: italic;">
                            No reservations yet. Reservations will appear here once created.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reservation Details Modal -->
    <div id="reservationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 10000; backdrop-filter: blur(5px); animation: fadeIn 0.3s ease;">
        <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;">
            <div id="reservationModalContent" style="background: white; border-radius: 20px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideUp 0.3s ease; position: relative;">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Edit Reservation Modal -->
    <div id="editReservationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 10001; backdrop-filter: blur(5px); animation: fadeIn 0.3s ease;">
        <div style="position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding: 20px; overflow-y: auto;">
            <div id="editReservationModalContent" style="background: white; border-radius: 20px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: slideUp 0.3s ease; position: relative;">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Crystal Acres. All rights reserved.</p>
            <p>278 Crystal Lake Rd, Gilmanton Iron Works, NH 03837</p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">Created by Riley Joseph Santor</p>
        </div>
    </footer>

    <script src="main.js"></script>
    <script>
        // Check admin status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminStatus();
            updateAdminButton();
            checkMaintenanceMode();
            loadDynamicPricing(); // Load and display updated pricing
            
            // Show admin content if logged in
            if (adminLoggedIn) {
                showAdminReservations();
            }
        });

        // Store selected cottages
        let selectedCottages = [];
        
        // Calendar state variables
        let currentCalendarDate = new Date();
        let selectedStartDate = null;
        let selectedEndDate = null;
        let bookedDates = {}; // Will store booked dates for each cottage

        // Cottage pricing data (will be overridden by localStorage if available)
        let cottagePricing = {
            'The Villa': {spring: 175, summer: 225, fall: 175, winter: 150},
            'The Brown Camp': {spring: 200, summer: 250, fall: 200, winter: 175},
            'The Shanty': {spring: 175, summer: 225, fall: 175, winter: 150},
            'The Bunkhouse': {spring: 75, summer: 100, fall: 75, winter: 60}
        };
        
        // Guest charge rates (will be overridden by localStorage if available)
        let ADULT_RATE = 30;
        let CHILD_RATE = 15;
        let PET_RATE = 20;
        let TAX_RATE = 0.085;
        
        // Load dynamic pricing from localStorage and update display
        function loadDynamicPricing() {
            const savedPricing = localStorage.getItem('cottagePricing');
            if (savedPricing) {
                const pricing = JSON.parse(savedPricing);
                
                // Update cottage pricing object
                cottagePricing['The Villa'] = pricing.villa;
                cottagePricing['The Brown Camp'] = pricing.brownCamp;
                cottagePricing['The Shanty'] = pricing.shanty;
                cottagePricing['The Bunkhouse'] = pricing.bunkhouse;
                
                // Update guest rates
                ADULT_RATE = pricing.guestCharges.adult;
                CHILD_RATE = pricing.guestCharges.child;
                PET_RATE = pricing.guestCharges.pet;
                TAX_RATE = pricing.tax / 100;
                
                // Update display on page
                updatePricingDisplay(pricing);
            }
        }
        
        // Update pricing display in cottage cards
        function updatePricingDisplay(pricing) {
            // Update Villa pricing
            const villaCard = document.querySelector('#cottage-villa');
            if (villaCard) {
                const villaPriceDiv = villaCard.querySelector('div[style*=\"linear-gradient(135deg, #4facfe\"]');
                if (villaPriceDiv) {
                    villaPriceDiv.innerHTML = `
                        <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                        <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $${pricing.villa.spring} | ‚òÄÔ∏è $${pricing.villa.summer}<br>üçÇ $${pricing.villa.fall} | ‚ùÑÔ∏è $${pricing.villa.winter}</div>
                    `;
                }
            }
            
            // Update Brown Camp pricing
            const brownCampCard = document.querySelector('#cottage-browncamp');
            if (brownCampCard) {
                const brownCampPriceDiv = brownCampCard.querySelector('div[style*=\"linear-gradient(135deg, #11998e\"]');
                if (brownCampPriceDiv) {
                    brownCampPriceDiv.innerHTML = `
                        <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                        <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $${pricing.brownCamp.spring} | ‚òÄÔ∏è $${pricing.brownCamp.summer}<br>üçÇ $${pricing.brownCamp.fall} | ‚ùÑÔ∏è $${pricing.brownCamp.winter}</div>
                    `;
                }
            }
            
            // Update Shanty pricing
            const shantyCard = document.querySelector('#cottage-shanty');
            if (shantyCard) {
                const shantyPriceDiv = shantyCard.querySelector('div[style*=\"linear-gradient(135deg, #fa709a\"]');
                if (shantyPriceDiv) {
                    shantyPriceDiv.innerHTML = `
                        <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night</div>
                        <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $${pricing.shanty.spring} | ‚òÄÔ∏è $${pricing.shanty.summer}<br>üçÇ $${pricing.shanty.fall} | ‚ùÑÔ∏è $${pricing.shanty.winter}</div>
                    `;
                }
            }
            
            // Update Bunkhouse pricing
            const bunkhouseCard = document.querySelector('#cottage-bunkhouse');
            if (bunkhouseCard) {
                const bunkhousePriceDiv = bunkhouseCard.querySelector('div[style*=\"linear-gradient(135deg, #667eea\"]');
                if (bunkhousePriceDiv) {
                    bunkhousePriceDiv.innerHTML = `
                        <div style="font-size: 0.85rem; opacity: 0.95; margin-bottom: 5px;">Per Night (Add-On)</div>
                        <div style="font-size: 1rem; font-weight: 700; line-height: 1.6;">üå∏ $${pricing.bunkhouse.spring} | ‚òÄÔ∏è $${pricing.bunkhouse.summer}<br>üçÇ $${pricing.bunkhouse.fall} | ‚ùÑÔ∏è $${pricing.bunkhouse.winter}</div>
                    `;
                }
            }
        }

        // Toggle cottage selection (uses clicked button to find card)
        function toggleCottageSelection(buttonEl, cottageName, maxGuests, bedrooms, pricing) {
            const cottageCard = buttonEl.closest('.cottage-compact-card');
            const existingIndex = selectedCottages.findIndex(c => c.name === cottageName);
            
            // Use current pricing from cottagePricing object (which includes any admin updates)
            const currentPricing = cottagePricing[cottageName] || pricing;
            
            if (existingIndex >= 0) {
                // Deselect
                selectedCottages.splice(existingIndex, 1);
                cottageCard.style.border = '';
                cottageCard.style.boxShadow = '';
                cottageCard.style.transform = '';
                const btn = cottageCard.querySelector('.cottage-select-btn');
                btn.textContent = '‚úó Select Cottage';
                btn.style.background = 'linear-gradient(135deg, #ee0979 0%, #ff6a00 100%)';
            } else {
                // Select - use current pricing, not the hardcoded pricing from onclick
                selectedCottages.push({
                    name: cottageName,
                    maxGuests: maxGuests,
                    bedrooms: bedrooms,
                    pricing: currentPricing
                });
                cottageCard.style.border = '4px solid #11998e';
                cottageCard.style.boxShadow = '0 0 25px rgba(17, 153, 142, 0.5)';
                cottageCard.style.transform = 'scale(1.02)';
                const btn = cottageCard.querySelector('.cottage-select-btn');
                btn.textContent = '‚úì Selected';
                btn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
            }
            
            updateContinueButton();
        }

        // Update continue button visibility and summary
        function updateContinueButton() {
            const continueSection = document.getElementById('continueBookingSection');
            const summary = document.getElementById('selectedCottagesSummary');
            
            if (selectedCottages.length > 0) {
                continueSection.style.display = 'block';
                const cottageNames = selectedCottages.map(c => c.name).join(', ');
                const totalMaxGuests = selectedCottages.reduce((sum, c) => sum + c.maxGuests, 0);
                summary.innerHTML = `<strong>Selected:</strong> ${cottageNames}<br><strong>Total Capacity:</strong> Up to ${totalMaxGuests} guests`;
            } else {
                continueSection.style.display = 'none';
            }
        }

        // Format date to local YYYY-MM-DD (avoids timezone issues)
        function formatDateLocal(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Proceed to final receipt/confirmation
        function proceedToBooking() {
            if (selectedCottages.length === 0) {
                alert('Please select at least one cottage.');
                return;
            }
            // Validate at least one date selected
            if (selectedDateSet.size === 0) {
                alert('Please select at least one date.');
                return;
            }
            
            // Get guest information
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const specialNotes = document.getElementById('specialNotes').value;
            
            // Hide calendar if visible
            const calendarSection = document.getElementById('calendarSection');
            if (calendarSection) {
                calendarSection.style.display = 'none';
            }
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Calculate dates
            const dates = Array.from(selectedDateSet).sort();
            const checkInDate = new Date(dates[0] + 'T00:00:00');
            const checkOutDate = new Date(dates[dates.length - 1] + 'T00:00:00');
            const totalNights = dates.length > 1 ? dates.length - 1 : 1;
            
            // Calculate pricing breakdown
            const seasonCounts = { spring: 0, summer: 0, fall: 0, winter: 0 };
            const seasonEmojis = { spring: 'üå∏', summer: '‚òÄÔ∏è', fall: 'üçÇ', winter: '‚ùÑÔ∏è' };
            const seasonNames = { spring: 'Spring', summer: 'Summer', fall: 'Fall', winter: 'Winter' };
            
            for (let i = 0; i < dates.length - 1; i++) {
                const date = new Date(dates[i] + 'T00:00:00');
                const season = getSeason(date);
                seasonCounts[season]++;
            }
            
            let cottageTotalPrice = 0;
            let cottageBreakdownHTML = '';
            
            selectedCottages.forEach(cottage => {
                let cottageTotal = 0;
                cottageBreakdownHTML += `<div style="margin-bottom: 15px; padding: 15px; background: rgba(79, 172, 254, 0.05); border-radius: 8px;">`;
                cottageBreakdownHTML += `<strong style="color: var(--primary-color);">${cottage.name}</strong> (Sleeps ${cottage.maxGuests})<br>`;
                
                for (const season in seasonCounts) {
                    if (seasonCounts[season] > 0) {
                        const nights = seasonCounts[season];
                        const rate = cottage.pricing[season];
                        const seasonTotal = rate * nights;
                        cottageTotal += seasonTotal;
                        cottageBreakdownHTML += `${seasonEmojis[season]} ${seasonNames[season]}: $${rate} √ó ${nights} night${nights !== 1 ? 's' : ''} = $${seasonTotal}<br>`;
                    }
                }
                
                cottageBreakdownHTML += `<strong>Subtotal: $${cottageTotal}</strong>`;
                cottageBreakdownHTML += `</div>`;
                cottageTotalPrice += cottageTotal;
            });
            
            // Guest charges
            const guestCharges = (numAdults * ADULT_RATE + numChildren * CHILD_RATE + numPets * PET_RATE) * totalNights;
            let guestBreakdownHTML = '';
            if (numAdults > 0) guestBreakdownHTML += `üë§ ${numAdults} Adult${numAdults !== 1 ? 's' : ''} √ó $${ADULT_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numAdults * ADULT_RATE * totalNights}<br>`;
            if (numChildren > 0) guestBreakdownHTML += `üë∂ ${numChildren} Child${numChildren !== 1 ? 'ren' : ''} √ó $${CHILD_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numChildren * CHILD_RATE * totalNights}<br>`;
            if (numPets > 0) guestBreakdownHTML += `üêæ ${numPets} Pet${numPets !== 1 ? 's' : ''} √ó $${PET_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numPets * PET_RATE * totalNights}<br>`;
            
            // Calculate subtotal and tax
            const subtotal = cottageTotalPrice + guestCharges;
            const taxAmount = subtotal * 0.085;
            const grandTotal = subtotal + taxAmount;
            
            const totalMaxGuests = selectedCottages.reduce((sum, c) => sum + c.maxGuests, 0);
            const cottageNames = selectedCottages.map(c => c.name).join(' + ');
            
            // Build individual cottage dates display if in individual mode
            let individualDatesHTML = '';
            if (multipleCottageMode === 'individual' && selectedCottages.length > 1) {
                individualDatesHTML = '<div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd;"><strong>Individual Cottage Dates:</strong><br>';
                selectedCottages.forEach(cottage => {
                    const cottageDates = Array.from(individualCottageDates[cottage.name] || new Set()).sort();
                    if (cottageDates.length > 0) {
                        const cottageCheckIn = new Date(cottageDates[0] + 'T00:00:00');
                        const cottageCheckOut = new Date(cottageDates[cottageDates.length - 1] + 'T00:00:00');
                        const cottageNights = cottageDates.length > 1 ? cottageDates.length - 1 : 1;
                        individualDatesHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(79, 172, 254, 0.05); border-radius: 6px;">
                            <strong style="color: var(--primary-color);">${cottage.name}:</strong> 
                            ${cottageCheckIn.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - 
                            ${cottageCheckOut.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} 
                            (${cottageNights} night${cottageNights !== 1 ? 's' : ''})
                        </div>`;
                    }
                });
                individualDatesHTML += '</div>';
            }
            
            // Replace content with receipt
            const container = document.querySelector('.booking-form-section .container');
            
            container.innerHTML = `
                <div class="booking-header">
                    <h1 style="text-align: center;">üéâ Reservation Summary</h1>
                    <p style="text-align: center;">Review your booking details below</p>
                </div>

                <div style="background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1); margin-top: 40px; max-width: 900px; margin-left: auto; margin-right: auto;">
                    
                    <!-- Guest Information -->
                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: 25px; border-radius: 12px; margin-bottom: 25px; color: white;">
                        <h2 style="margin: 0 0 15px 0; font-size: 1.5rem;">Guest Information</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; line-height: 1.8;">
                            <div><strong>Name:</strong> ${firstName} ${lastName}</div>
                            <div><strong>Email:</strong> ${email}</div>
                            <div><strong>Phone:</strong> ${phone}</div>
                            <div><strong>Guests:</strong> ${numAdults} Adult${numAdults !== 1 ? 's' : ''}${numChildren > 0 ? `, ${numChildren} Child${numChildren !== 1 ? 'ren' : ''}` : ''}${numPets > 0 ? `, ${numPets} Pet${numPets !== 1 ? 's' : ''}` : ''}</div>
                        </div>
                    </div>

                    <!-- Reservation Details -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
                        <h2 style="margin: 0 0 15px 0; font-size: 1.5rem; color: #333;">Reservation Details</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; line-height: 1.8; color: #555;">
                            <div><strong>Check-In:</strong> ${checkInDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                            <div><strong>Check-Out:</strong> ${checkOutDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                            <div><strong>Duration:</strong> ${totalNights} Night${totalNights !== 1 ? 's' : ''}</div>
                            <div><strong>Cottage(s):</strong> ${cottageNames}</div>
                        </div>
                        ${individualDatesHTML}
                        ${specialNotes ? `<div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #ddd;"><strong>Special Requests:</strong><br>${specialNotes}</div>` : ''}
                    </div>

                    <!-- Price Breakdown -->
                    <div style="background: #fff; padding: 25px; border-radius: 12px; border: 2px solid #4facfe; margin-bottom: 25px;">
                        <h2 style="margin: 0 0 20px 0; font-size: 1.5rem; color: var(--primary-color); text-align: center;">Price Breakdown</h2>
                        
                        <!-- Cottage Charges -->
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #333; margin: 0 0 10px 0; font-size: 1.2rem;">Cottage Charges</h3>
                            ${cottageBreakdownHTML}
                            <div style="text-align: right; font-size: 1.1rem; font-weight: 600; margin-top: 10px; color: #333;">
                                Cottage Total: $${cottageTotalPrice.toFixed(2)}
                            </div>
                        </div>

                        ${guestCharges > 0 ? `
                        <!-- Guest Charges -->
                        <div style="margin-bottom: 20px; padding-top: 20px; border-top: 2px solid #eee;">
                            <h3 style="color: #4caf50; margin: 0 0 10px 0; font-size: 1.2rem;">Guest Charges</h3>
                            <div style="padding: 15px; background: rgba(76, 175, 80, 0.05); border-radius: 8px;">
                                ${guestBreakdownHTML}
                                <strong>Guest Total: $${guestCharges.toFixed(2)}</strong>
                            </div>
                        </div>
                        ` : ''}

                        <!-- Tax & Total -->
                        <div style="padding-top: 20px; border-top: 3px solid #4facfe;">
                            <div style="display: flex; justify-content: space-between; font-size: 1.1rem; margin-bottom: 10px;">
                                <span><strong>Subtotal:</strong></span>
                                <span>$${subtotal.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 1.1rem; margin-bottom: 15px; color: #ff9800;">
                                <span><strong>üèõÔ∏è Meals & Rooms Tax (8.5%):</strong></span>
                                <span>$${taxAmount.toFixed(2)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 2rem; font-weight: 700; color: var(--primary-color); padding-top: 15px; border-top: 3px solid #4facfe;">
                                <span>GRAND TOTAL:</span>
                                <span>$${grandTotal.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="button" onclick="location.reload()" class="btn btn-secondary" style="flex: 1; background: #95a5a6; padding: 15px 40px; font-size: 1.1rem;">
                            ‚Üê Start Over
                        </button>
                        <button type="button" onclick="confirmAndSubmitReservation('${firstName}', '${lastName}', '${email}', '${phone}', '${cottageNames}', '${checkInDate.toISOString().split('T')[0]}', '${checkOutDate.toISOString().split('T')[0]}', ${numAdults}, ${numChildren}, ${numPets}, '${specialNotes.replace(/'/g, "\\'")}', ${grandTotal.toFixed(2)})" class="btn-submit" style="flex: 2; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer;">
                            ‚úì Confirm Reservation
                        </button>
                    </div>
                </div>

                <!-- Admin Reservations List -->
                <div id="adminReservationsList" style="display: ${adminLoggedIn ? 'block' : 'none'}; margin-top: 60px;">
                    <div style="background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 30px rgba(0,0,0,0.1);">
                        <h2 style="color: var(--primary-color); margin-bottom: 30px; display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 2rem;">üìã</span>
                            All Reservations
                        </h2>
                        <div id="reservationsList">
                            <p style="text-align: center; color: var(--text-light); padding: 40px; font-style: italic;">
                                Loading reservations...
                            </p>
                        </div>
                    </div>
                </div>
            `;

            // Load reservations if admin
            if (adminLoggedIn) {
                setTimeout(() => loadReservations(), 100);
            }
            
            // Setup price calculator
            setTimeout(() => calculatePrice(), 100);
        }

        // Calculate price based on dates and selected cottages
        function calculatePrice() {
            const checkInInput = document.getElementById('checkInDate');
            const checkOutInput = document.getElementById('checkOutDate');
            const priceEstimate = document.getElementById('priceEstimate');
            const priceBreakdown = document.getElementById('priceBreakdown');
            const totalPriceDiv = document.getElementById('totalPrice');
            
            if (!checkInInput || !checkOutInput || !priceEstimate) return;
            
            const checkIn = checkInInput.value;
            const checkOut = checkOutInput.value;
            
            if (!checkIn || !checkOut) {
                priceEstimate.style.display = 'none';
                return;
            }
            
            const checkInDate = new Date(checkIn);
            const checkOutDate = new Date(checkOut);
            
            if (checkOutDate <= checkInDate) {
                priceEstimate.style.display = 'none';
                return;
            }
            
            // Calculate number of nights
            const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            
            // Determine season for check-in date
            const month = checkInDate.getMonth() + 1;
            let season = 'spring';
            
            // Spring: March 1 - May 31
            if (month >= 3 && month <= 5) {
                season = 'spring';
            }
            // Summer: June 1 - August 31
            else if (month >= 6 && month <= 8) {
                season = 'summer';
            }
            // Fall: September 1 - November 30
            else if (month >= 9 && month <= 11) {
                season = 'fall';
            }
            // Winter: December 1 - February 28/29
            else if (month === 12 || month === 1 || month === 2) {
                season = 'winter';
            }
            
            // Calculate total
            let total = 0;
            let breakdownText = '';
            
            selectedCottages.forEach(cottage => {
                const pricePerNight = cottage.pricing[season];
                const cottageTotal = pricePerNight * nights;
                total += cottageTotal;
                breakdownText += `${cottage.name}: $${pricePerNight} √ó ${nights} night${nights > 1 ? 's' : ''} = $${cottageTotal}<br>`;
            });
            
            const seasonEmoji = season === 'summer' ? '‚òÄÔ∏è' : season === 'winter' ? '‚ùÑÔ∏è' : season === 'fall' ? 'üçÇ' : 'üå∏';
            const seasonName = season.charAt(0).toUpperCase() + season.slice(1);
            
            priceBreakdown.innerHTML = `<strong>${seasonEmoji} ${seasonName} Season</strong> ‚Ä¢ ${nights} night${nights > 1 ? 's' : ''}<br>${breakdownText}`;
            totalPriceDiv.textContent = `$${total.toFixed(2)}`;
            priceEstimate.style.display = 'block';
        }

        // Confirm and submit reservation from receipt
        function confirmAndSubmitReservation(firstName, lastName, email, phone, cottageNames, checkIn, checkOut, adults, children, pets, notes, totalPrice) {
            const dates = Array.from(selectedDateSet).sort();
            const nights = dates.length > 1 ? dates.length - 1 : 1;
            
            // Calculate season breakdown
            const seasonCounts = { spring: 0, summer: 0, fall: 0, winter: 0 };
            for (let i = 0; i < dates.length - 1; i++) {
                const date = new Date(dates[i] + 'T00:00:00');
                const season = getSeason(date);
                seasonCounts[season]++;
            }
            
            // Determine dominant season
            let dominantSeason = 'winter';
            let maxNights = 0;
            for (const season in seasonCounts) {
                if (seasonCounts[season] > maxNights) {
                    maxNights = seasonCounts[season];
                    dominantSeason = season;
                }
            }
            
            // Build detailed cottage pricing data
            const cottagesPricing = [];
            selectedCottages.forEach(cottage => {
                const cottageData = {
                    name: cottage.name,
                    pricing: cottage.pricing,
                    seasonalBreakdown: {}
                };
                
                for (const season in seasonCounts) {
                    if (seasonCounts[season] > 0) {
                        cottageData.seasonalBreakdown[season] = {
                            nights: seasonCounts[season],
                            rate: cottage.pricing[season],
                            total: cottage.pricing[season] * seasonCounts[season]
                        };
                    }
                }
                
                cottagesPricing.push(cottageData);
            });
            
            // Calculate guest charges breakdown
            const guestChargesBreakdown = {
                adults: { count: adults, rate: ADULT_RATE, total: adults * ADULT_RATE * nights },
                children: { count: children, rate: CHILD_RATE, total: children * CHILD_RATE * nights },
                pets: { count: pets, rate: PET_RATE, total: pets * PET_RATE * nights }
            };
            
            // Store individual cottage date ranges if in individual mode
            const individualCottageDateRanges = {};
            if (multipleCottageMode === 'individual') {
                selectedCottages.forEach(cottage => {
                    if (individualCottageDates[cottage.name] && individualCottageDates[cottage.name].size > 0) {
                        const dates = Array.from(individualCottageDates[cottage.name]).sort();
                        individualCottageDateRanges[cottage.name] = {
                            checkIn: dates[0],
                            checkOut: dates[dates.length - 1],
                            dates: dates
                        };
                    }
                });
            }
            
            // Create reservation object with detailed pricing
            const reservation = {
                id: Date.now(),
                name: `${firstName} ${lastName}`,
                email: email,
                phone: phone,
                cottage: cottageNames,
                cottagesList: selectedCottages.map(c => c.name),
                cottagesPricing: cottagesPricing,
                individualCottageDates: individualCottageDateRanges,
                multipleCottageMode: multipleCottageMode,
                checkIn: checkIn,
                checkOut: checkOut,
                nights: nights,
                season: dominantSeason,
                seasonCounts: seasonCounts,
                guests: `${adults} Adult${adults !== 1 ? 's' : ''}${children > 0 ? `, ${children} Child${children !== 1 ? 'ren' : ''}` : ''}${pets > 0 ? `, ${pets} Pet${pets !== 1 ? 's' : ''}` : ''}`,
                adults: adults,
                children: children,
                pets: pets,
                guestChargesBreakdown: guestChargesBreakdown,
                notes: notes,
                estimatedPrice: totalPrice,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            reservations.push(reservation);
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // Show success message
            alert(`‚úÖ Reservation Confirmed!\n\nThank you for your reservation. A confirmation has been saved.\n\nReservation ID: ${reservation.id}\nGuest: ${reservation.name}\nCottage(s): ${cottageNames}\nCheck-In: ${checkIn}\nCheck-Out: ${checkOut}\nTotal: $${totalPrice}\n\nWe look forward to your visit!`);
            
            // Reload page
            location.reload();
        }

        // Submit reservation
        function submitReservation(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Validate dates
            const checkInDate = new Date(formData.get('checkIn'));
            const checkOutDate = new Date(formData.get('checkOut'));
            
            if (checkOutDate <= checkInDate) {
                alert('‚ö†Ô∏è Check-out date must be after check-in date.');
                return;
            }
            
            // Calculate nights and pricing
            const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            const month = checkInDate.getMonth() + 1;
            let season = 'spring';
            
            // Spring: March 1 - May 31
            if (month >= 3 && month <= 5) {
                season = 'spring';
            }
            // Summer: June 1 - August 31
            else if (month >= 6 && month <= 8) {
                season = 'summer';
            }
            // Fall: September 1 - November 30
            else if (month >= 9 && month <= 11) {
                season = 'fall';
            }
            // Winter: December 1 - February 28/29
            else if (month === 12 || month === 1 || month === 2) {
                season = 'winter';
            }
            
            let totalPrice = 0;
            selectedCottages.forEach(cottage => {
                totalPrice += cottage.pricing[season] * nights;
            });
            
            // Create reservation object
            const reservation = {
                id: Date.now(),
                name: formData.get('firstName') + ' ' + formData.get('lastName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                cottage: formData.get('cottages'),
                cottagesList: selectedCottages.map(c => c.name),
                checkIn: formData.get('checkIn'),
                checkOut: formData.get('checkOut'),
                nights: nights,
                season: season,
                guests: formData.get('guests'),
                children: formData.get('children') || 0,
                notes: formData.get('notes') || '',
                pets: formData.get('pets') ? 'Yes' : 'No',
                estimatedPrice: totalPrice,
                status: 'pending',
                createdAt: new Date().toISOString()
            };
            
            // Save to localStorage
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            reservations.push(reservation);
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // Show success message
            const seasonEmoji = season === 'summer' ? '‚òÄÔ∏è' : season === 'winter' ? '‚ùÑÔ∏è' : season === 'fall' ? 'üçÇ' : 'üå∏';
            alert('‚úÖ Reservation Request Submitted!\n\nThank you for your reservation request. We will contact you shortly to confirm your booking.\n\nReservation Details:\n' +
                  '‚Ä¢ Cottage(s): ' + reservation.cottage + '\n' +
                  '‚Ä¢ Check-In: ' + checkInDate.toLocaleDateString() + '\n' +
                  '‚Ä¢ Check-Out: ' + checkOutDate.toLocaleDateString() + '\n' +
                  '‚Ä¢ Nights: ' + nights + '\n' +
                  '‚Ä¢ Season: ' + seasonEmoji + ' ' + season.charAt(0).toUpperCase() + season.slice(1) + '\n' +
                  '‚Ä¢ Guests: ' + reservation.guests + '\n' +
                  '‚Ä¢ Estimated Total: $' + totalPrice.toFixed(2));
            
            // Reload page
            location.reload();
        }

        // Show admin reservations list
        function showAdminReservations() {
            const adminList = document.getElementById('adminReservationsList');
            if (adminList) {
                adminList.style.display = 'block';
                loadReservations();
            }
        }

        // Load reservations from localStorage
        function loadReservations() {
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            const reservationsList = document.getElementById('reservationsList');
            
            if (!reservationsList) return;
            
            if (reservations.length === 0) {
                reservationsList.innerHTML = `
                    <p style="text-align: center; color: var(--text-light); padding: 40px; font-style: italic;">
                        No reservations yet. Reservations will appear here once created.
                    </p>
                `;
                return;
            }
            
            // Sort reservations by check-in date
            reservations.sort((a, b) => new Date(a.checkIn) - new Date(b.checkIn));
            
            // Display reservations
            reservationsList.innerHTML = reservations.map((reservation, index) => {
                const checkInDate = new Date(reservation.checkIn + 'T00:00:00');
                const checkOutDate = new Date(reservation.checkOut + 'T00:00:00');
                
                const checkIn = checkInDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                const checkOut = checkOutDate.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Calculate actual nights stayed
                const nightsStayed = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
                
                // Determine status color
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let statusBadge = '';
                let statusColor = '';
                
                if (today < checkInDate) {
                    statusBadge = 'Upcoming';
                    statusColor = '#4facfe';
                } else if (today >= checkInDate && today <= checkOutDate) {
                    statusBadge = 'Active';
                    statusColor = '#11998e';
                } else {
                    statusBadge = 'Completed';
                    statusColor = '#95a5a6';
                }
                
                return `
                    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 5px solid ${statusColor}; box-shadow: 0 3px 15px rgba(0,0,0,0.08); transition: all 0.3s ease;" onmouseover="this.style.transform='translateX(5px)'; this.style.boxShadow='0 5px 20px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 3px 15px rgba(0,0,0,0.08)';">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; flex-wrap: wrap; gap: 15px;">
                            <div>
                                <h3 style="color: var(--primary-color); margin: 0 0 10px 0; font-size: 1.5rem;">
                                    ${reservation.name || 'Guest'}
                                </h3>
                                <div style="display: flex; gap: 20px; flex-wrap: wrap; color: var(--text-dark); font-size: 0.95rem;">
                                    <span style="display: flex; align-items: center; gap: 6px;">
                                        <span style="font-size: 1.2rem;">üìß</span>
                                        ${reservation.email || 'No email'}
                                    </span>
                                    <span style="display: flex; align-items: center; gap: 6px;">
                                        <span style="font-size: 1.2rem;">üìû</span>
                                        ${reservation.phone || 'No phone'}
                                    </span>
                                </div>
                            </div>
                            <span style="padding: 8px 20px; background: ${statusColor}; color: white; border-radius: 20px; font-weight: 700; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 3px 10px ${statusColor}44;">
                                ${statusBadge}
                            </span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 15px; background: white; border-radius: 8px;">
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Cottage(s)</div>
                                <div style="font-size: 1.1rem; color: var(--primary-color); font-weight: 700;">
                                    ${reservation.cottage || 'Not specified'}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Check-In</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600;">
                                    ${checkIn}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Check-Out</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600;">
                                    ${checkOut}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Duration</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600;">
                                    ${nightsStayed} night${nightsStayed !== 1 ? 's' : ''}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Guests</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600;">
                                    ${reservation.guests || 'Not specified'}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: 600;">Estimated Price</div>
                                <div style="font-size: 1.1rem; color: #11998e; font-weight: 700;">
                                    $${reservation.estimatedPrice ? reservation.estimatedPrice.toFixed(2) : 'N/A'}
                                </div>
                            </div>
                        </div>
                        
                        ${reservation.notes ? `
                            <div style="padding: 15px; background: rgba(79, 172, 254, 0.05); border-radius: 8px; border-left: 3px solid #4facfe; margin-bottom: 15px;">
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600;">Special Requests:</div>
                                <div style="font-size: 0.95rem; color: var(--text-dark); line-height: 1.5;">
                                    ${reservation.notes}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button onclick="viewReservation(${index})" style="flex: 1; min-width: 120px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; box-shadow: 0 3px 10px rgba(79, 172, 254, 0.3); transition: all 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(79, 172, 254, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(79, 172, 254, 0.3)';">
                                üëÅÔ∏è View Details
                            </button>
                            <button onclick="editReservation(${index})" style="flex: 1; min-width: 120px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; box-shadow: 0 3px 10px rgba(56, 239, 125, 0.3); transition: all 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(56, 239, 125, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(56, 239, 125, 0.3)';">
                                ‚úèÔ∏è Edit
                            </button>
                            <button onclick="deleteReservation(${index})" style="flex: 1; min-width: 120px; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; box-shadow: 0 3px 10px rgba(238, 9, 121, 0.3); transition: all 0.2s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(238, 9, 121, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(238, 9, 121, 0.3)';">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Open reservation manager (admin panel)
        function openReservationManager() {
            if (!adminLoggedIn) {
                alert('‚ö†Ô∏è You must be logged in as admin to access Reservation Manager.');
                return;
            }
            
            // Get current pricing
            const pricing = JSON.parse(localStorage.getItem('cottagePricing') || JSON.stringify({
                villa: { spring: 175, summer: 225, fall: 175, winter: 150 },
                brownCamp: { spring: 200, summer: 250, fall: 200, winter: 175 },
                shanty: { spring: 175, summer: 225, fall: 175, winter: 150 },
                bunkhouse: { spring: 75, summer: 100, fall: 75, winter: 60 },
                guestCharges: { adult: 30, child: 15, pet: 20 },
                tax: 8.5
            }));
            
            // Create modal
            const modal = document.createElement('div');
            modal.id = 'pricingManagerModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(5px);';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; padding: 40px; max-width: 900px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3); animation: slideUp 0.3s ease;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2 style="margin: 0; color: #333; font-size: 2rem; display: flex; align-items: center; gap: 12px;">
                            <span>üí∞</span> Reservation Manager - Pricing
                        </h2>
                        <button onclick="closePricingManager()" style="background: #e74c3c; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem; transition: all 0.3s ease;" onmouseover="this.style.transform='rotate(90deg)';" onmouseout="this.style.transform='rotate(0deg)';">
                            √ó
                        </button>
                    </div>
                    
                    <!-- Cottage Pricing Sections -->
                    <div style="display: grid; gap: 25px;">
                        <!-- The Villa -->
                        <div style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #4facfe;">
                            <h3 style="margin: 0 0 20px 0; color: #4facfe; font-size: 1.4rem;">üè° The Villa</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üå∏ Spring</label>
                                    <input type="number" id="villa-spring" value="${pricing.villa.spring}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚òÄÔ∏è Summer</label>
                                    <input type="number" id="villa-summer" value="${pricing.villa.summer}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üçÇ Fall</label>
                                    <input type="number" id="villa-fall" value="${pricing.villa.fall}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚ùÑÔ∏è Winter</label>
                                    <input type="number" id="villa-winter" value="${pricing.villa.winter}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- The Brown Camp -->
                        <div style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #11998e;">
                            <h3 style="margin: 0 0 20px 0; color: #11998e; font-size: 1.4rem;">üè° The Brown Camp</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üå∏ Spring</label>
                                    <input type="number" id="browncamp-spring" value="${pricing.brownCamp.spring}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚òÄÔ∏è Summer</label>
                                    <input type="number" id="browncamp-summer" value="${pricing.brownCamp.summer}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üçÇ Fall</label>
                                    <input type="number" id="browncamp-fall" value="${pricing.brownCamp.fall}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚ùÑÔ∏è Winter</label>
                                    <input type="number" id="browncamp-winter" value="${pricing.brownCamp.winter}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- The Shanty -->
                        <div style="background: linear-gradient(135deg, rgba(250, 112, 154, 0.1) 0%, rgba(254, 225, 64, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #fa709a;">
                            <h3 style="margin: 0 0 20px 0; color: #fa709a; font-size: 1.4rem;">üè° The Shanty</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üå∏ Spring</label>
                                    <input type="number" id="shanty-spring" value="${pricing.shanty.spring}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚òÄÔ∏è Summer</label>
                                    <input type="number" id="shanty-summer" value="${pricing.shanty.summer}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üçÇ Fall</label>
                                    <input type="number" id="shanty-fall" value="${pricing.shanty.fall}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚ùÑÔ∏è Winter</label>
                                    <input type="number" id="shanty-winter" value="${pricing.shanty.winter}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- The Bunkhouse -->
                        <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #667eea;">
                            <h3 style="margin: 0 0 20px 0; color: #667eea; font-size: 1.4rem;">üè° The Bunkhouse</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üå∏ Spring</label>
                                    <input type="number" id="bunkhouse-spring" value="${pricing.bunkhouse.spring}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚òÄÔ∏è Summer</label>
                                    <input type="number" id="bunkhouse-summer" value="${pricing.bunkhouse.summer}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üçÇ Fall</label>
                                    <input type="number" id="bunkhouse-fall" value="${pricing.bunkhouse.fall}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">‚ùÑÔ∏è Winter</label>
                                    <input type="number" id="bunkhouse-winter" value="${pricing.bunkhouse.winter}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Guest Charges -->
                        <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(129, 199, 132, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #4caf50;">
                            <h3 style="margin: 0 0 20px 0; color: #4caf50; font-size: 1.4rem;">üë• Guest Charges (Per Night)</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üë§ Adult</label>
                                    <input type="number" id="guest-adult" value="${pricing.guestCharges.adult}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üë∂ Child</label>
                                    <input type="number" id="guest-child" value="${pricing.guestCharges.child}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">üêæ Pet</label>
                                    <input type="number" id="guest-pet" value="${pricing.guestCharges.pet}" min="0" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tax Rate -->
                        <div style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%); padding: 25px; border-radius: 12px; border: 2px solid #ff9800;">
                            <h3 style="margin: 0 0 20px 0; color: #ff9800; font-size: 1.4rem;">üèõÔ∏è Tax Rate</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                                <div>
                                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #555;">Meals & Rooms Tax (%)</label>
                                    <input type="number" id="tax-rate" value="${pricing.tax}" min="0" max="100" step="0.1" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button onclick="savePricing()" style="flex: 2; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; box-shadow: 0 5px 15px rgba(56, 239, 125, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(56, 239, 125, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(56, 239, 125, 0.3)';">
                            ‚úì Save All Pricing
                        </button>
                        <button onclick="closePricingManager()" style="flex: 1; background: #95a5a6; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#7f8c8d';" onmouseout="this.style.background='#95a5a6';">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
        }
        
        function closePricingManager() {
            const modal = document.getElementById('pricingManagerModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }
        
        function savePricing() {
            const pricing = {
                villa: {
                    spring: parseFloat(document.getElementById('villa-spring').value) || 175,
                    summer: parseFloat(document.getElementById('villa-summer').value) || 225,
                    fall: parseFloat(document.getElementById('villa-fall').value) || 175,
                    winter: parseFloat(document.getElementById('villa-winter').value) || 150
                },
                brownCamp: {
                    spring: parseFloat(document.getElementById('browncamp-spring').value) || 200,
                    summer: parseFloat(document.getElementById('browncamp-summer').value) || 250,
                    fall: parseFloat(document.getElementById('browncamp-fall').value) || 200,
                    winter: parseFloat(document.getElementById('browncamp-winter').value) || 175
                },
                shanty: {
                    spring: parseFloat(document.getElementById('shanty-spring').value) || 175,
                    summer: parseFloat(document.getElementById('shanty-summer').value) || 225,
                    fall: parseFloat(document.getElementById('shanty-fall').value) || 175,
                    winter: parseFloat(document.getElementById('shanty-winter').value) || 150
                },
                bunkhouse: {
                    spring: parseFloat(document.getElementById('bunkhouse-spring').value) || 75,
                    summer: parseFloat(document.getElementById('bunkhouse-summer').value) || 100,
                    fall: parseFloat(document.getElementById('bunkhouse-fall').value) || 75,
                    winter: parseFloat(document.getElementById('bunkhouse-winter').value) || 60
                },
                guestCharges: {
                    adult: parseFloat(document.getElementById('guest-adult').value) || 30,
                    child: parseFloat(document.getElementById('guest-child').value) || 15,
                    pet: parseFloat(document.getElementById('guest-pet').value) || 20
                },
                tax: parseFloat(document.getElementById('tax-rate').value) || 8.5
            };
            
            localStorage.setItem('cottagePricing', JSON.stringify(pricing));
            
            alert('‚úÖ Pricing updated successfully!\n\nNew pricing will be used for all future reservations. Existing reservations keep their original pricing.');
            
            closePricingManager();
            
            // Refresh page to show updated prices
            location.reload();
        }
        
        // Note: Cottage buttons and price displays will update on page reload via loadDynamicPricing()

        // View reservation details in modal
        function viewReservation(index) {
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            const reservation = reservations[index];
            
            if (!reservation) {
                alert('‚ö†Ô∏è Reservation not found.');
                return;
            }
            
            const checkInDate = new Date(reservation.checkIn + 'T00:00:00');
            const checkOutDate = new Date(reservation.checkOut + 'T00:00:00');
            
            const checkIn = checkInDate.toLocaleDateString('en-US', { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const checkOut = checkOutDate.toLocaleDateString('en-US', { 
                weekday: 'long',
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Calculate nights
            const nightsStayed = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            
            // Determine status
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let statusBadge = '';
            let statusColor = '';
            let statusIcon = '';
            
            if (today < checkInDate) {
                statusBadge = 'Upcoming Reservation';
                statusColor = '#4facfe';
                statusIcon = 'üìÖ';
            } else if (today >= checkInDate && today <= checkOutDate) {
                statusBadge = 'Active Reservation';
                statusColor = '#11998e';
                statusIcon = '‚úÖ';
            } else {
                statusBadge = 'Completed Reservation';
                statusColor = '#95a5a6';
                statusIcon = '‚úì';
            }
            
            // Build guest details
            let guestDetails = `${reservation.adults || 0} Adult${(reservation.adults || 0) !== 1 ? 's' : ''}`;
            if (reservation.children && reservation.children > 0) {
                guestDetails += `, ${reservation.children} Child${reservation.children !== 1 ? 'ren' : ''}`;
            }
            if (reservation.pets && reservation.pets > 0) {
                guestDetails += `, ${reservation.pets} Pet${reservation.pets !== 1 ? 's' : ''}`;
            }
            
            // Build pricing breakdown if available
            let pricingHTML = '';
            if (reservation.estimatedPrice) {
                pricingHTML = `
                    <div style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üí∞</span> Pricing Details
                        </h3>
                        <div style="background: white; padding: 20px; border-radius: 10px;">
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 15px; margin-bottom: 15px;">
                                <span style="color: #666; font-weight: 600;">Cottage Rate (${nightsStayed} night${nightsStayed !== 1 ? 's' : ''})</span>
                                <span style="color: #333; font-weight: 700; font-size: 1.1rem;">$${(reservation.estimatedPrice || 0).toFixed(2)}</span>
                            </div>
                            ${reservation.season ? `
                                <div style="padding: 12px; background: rgba(79, 172, 254, 0.08); border-radius: 8px; border-left: 3px solid #4facfe; margin-top: 10px;">
                                    <span style="font-size: 0.9rem; color: #666;">Season: <strong style="color: #4facfe; text-transform: capitalize;">${reservation.season}</strong></span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            const modalContent = `
                <!-- Close Button -->
                <button onclick="closeReservationModal()" style="position: absolute; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.1); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; color: #333; transition: all 0.3s ease; z-index: 10; display: flex; align-items: center; justify-content: center;" onmouseover="this.style.background='rgba(0, 0, 0, 0.2)'; this.style.transform='rotate(90deg)';" onmouseout="this.style.background='rgba(0, 0, 0, 0.1)'; this.style.transform='rotate(0deg)';">
                    ‚úï
                </button>
                
                <!-- Header -->
                <div style="background: linear-gradient(135deg, ${statusColor} 0%, ${statusColor}dd 100%); color: white; padding: 40px 30px; border-radius: 20px 20px 0 0;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <span style="font-size: 3rem;">${statusIcon}</span>
                        <div>
                            <div style="font-size: 0.9rem; opacity: 0.95; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">
                                ${statusBadge}
                            </div>
                            <h2 style="margin: 0; font-size: 2rem; font-weight: 700;">
                                ${reservation.name || 'Guest Name'}
                            </h2>
                        </div>
                    </div>
                    <div style="display: flex; gap: 25px; flex-wrap: wrap; margin-top: 20px; opacity: 0.95;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.2rem;">üìß</span>
                            <span>${reservation.email || 'No email'}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 1.2rem;">üìû</span>
                            <span>${reservation.phone || 'No phone'}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Content -->
                <div style="padding: 30px;">
                    <!-- Reservation Details -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üè°</span> Reservation Details
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Cottage(s)</div>
                                <div style="font-size: 1.2rem; color: var(--primary-color); font-weight: 700;">
                                    ${reservation.cottage || 'Not specified'}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Check-In</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600; line-height: 1.4;">
                                    ${checkIn}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Check-Out</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600; line-height: 1.4;">
                                    ${checkOut}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Duration</div>
                                <div style="font-size: 1.2rem; color: #11998e; font-weight: 700;">
                                    ${nightsStayed} Night${nightsStayed !== 1 ? 's' : ''}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Guests</div>
                                <div style="font-size: 1rem; color: var(--text-dark); font-weight: 600;">
                                    ${guestDetails}
                                </div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Booking ID</div>
                                <div style="font-size: 0.9rem; color: var(--text-dark); font-weight: 600; font-family: monospace;">
                                    #${reservation.id || 'N/A'}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${pricingHTML}
                    
                    ${reservation.notes ? `
                        <div style="background: linear-gradient(135deg, #fff3cd 0%, #fff9e6 100%); padding: 25px; border-radius: 12px; border-left: 4px solid #ffc107; margin-bottom: 20px;">
                            <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                                <span>üìù</span> Special Requests
                            </h3>
                            <div style="font-size: 1rem; color: #555; line-height: 1.7; background: white; padding: 15px; border-radius: 8px;">
                                ${reservation.notes}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${reservation.createdAt ? `
                        <div style="text-align: center; padding: 15px; background: rgba(0, 0, 0, 0.02); border-radius: 8px; font-size: 0.85rem; color: #666;">
                            <span>Reservation created on ${new Date(reservation.createdAt).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                        </div>
                    ` : ''}
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap;">
                        <button onclick="closeReservationModal(); editReservation(${index});" style="flex: 1; min-width: 150px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: 0 5px 15px rgba(56, 239, 125, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(56, 239, 125, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(56, 239, 125, 0.3)';">
                            ‚úèÔ∏è Edit Reservation
                        </button>
                        <button onclick="closeReservationModal(); deleteReservation(${index});" style="flex: 1; min-width: 150px; background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 600; box-shadow: 0 5px 15px rgba(238, 9, 121, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(238, 9, 121, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(238, 9, 121, 0.3)';">
                            üóëÔ∏è Delete Reservation
                        </button>
                        <button onclick="closeReservationModal()" style="flex: 1; min-width: 150px; background: #95a5a6; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#7f8c8d';" onmouseout="this.style.background='#95a5a6';">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            // Show modal
            document.getElementById('reservationModalContent').innerHTML = modalContent;
            document.getElementById('reservationModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        // Close reservation modal
        function closeReservationModal() {
            document.getElementById('reservationModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('reservationModal');
            if (e.target === modal) {
                closeReservationModal();
            }
        });
        
        // Close modals with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeReservationModal();
                closeEditModal();
            }
        });

        // Edit reservation
        function editReservation(index) {
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            const reservation = reservations[index];
            
            if (!reservation) {
                alert('‚ö†Ô∏è Reservation not found.');
                return;
            }
            
            // Store original reservation data for price comparison
            editReservation.originalReservation = reservation;
            
            const modalContent = `
                <!-- Close Button -->
                <button onclick="closeEditModal()" style="position: absolute; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.1); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; color: #333; transition: all 0.3s ease; z-index: 10; display: flex; align-items: center; justify-content: center;" onmouseover="this.style.background='rgba(0, 0, 0, 0.2)'; this.style.transform='rotate(90deg)';" onmouseout="this.style.background='rgba(0, 0, 0, 0.1)'; this.style.transform='rotate(0deg)';">
                    ‚úï
                </button>
                
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 40px 30px; border-radius: 20px 20px 0 0;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span style="font-size: 3rem;">‚úèÔ∏è</span>
                        <div>
                            <h2 style="margin: 0; font-size: 2rem; font-weight: 700;">Edit Reservation</h2>
                            <p style="margin: 5px 0 0 0; opacity: 0.95; font-size: 1rem;">Modify reservation details below</p>
                        </div>
                    </div>
                </div>
                
                <!-- Form Content -->
                <form id="editReservationForm" style="padding: 30px;">
                    ${reservation.cottagesPricing ? `
                    <!-- Original Booking Info -->
                    <div style="background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #00acc1;">
                        <h3 style="margin: 0 0 15px 0; color: #00695c; font-size: 1.2rem; display: flex; align-items: center; gap: 10px;">
                            <span>üìä</span> Original Booking Details
                        </h3>
                        <div style="color: #004d40; line-height: 1.8; font-size: 0.95rem;">
                            <strong>Original Price:</strong> $${reservation.estimatedPrice ? reservation.estimatedPrice.toFixed(2) : 'N/A'}<br>
                            <strong>Cottages Booked:</strong> ${reservation.cottagesPricing.map(c => c.name).join(', ')}<br>
                            ${reservation.seasonCounts ? `<strong>Nights by Season:</strong> ${Object.entries(reservation.seasonCounts).filter(([s, n]) => n > 0).map(([s, n]) => `${s.charAt(0).toUpperCase() + s.slice(1)}: ${n}`).join(', ')}` : ''}
                            ${reservation.guestChargesBreakdown ? `<br><strong>Guest Charges:</strong> ${reservation.adults} Adults ($${reservation.guestChargesBreakdown.adults.rate}/night), ${reservation.children} Children ($${reservation.guestChargesBreakdown.children.rate}/night), ${reservation.pets} Pets ($${reservation.guestChargesBreakdown.pets.rate}/night)` : ''}
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: rgba(255, 255, 255, 0.5); border-radius: 6px; font-size: 0.9rem; color: #00695c;">
                            <strong>üí° Note:</strong> Prices below will automatically recalculate based on your changes
                        </div>
                    </div>
                    ` : ''}
                    <!-- Guest Information -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üë§</span> Guest Information
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Guest Name *</label>
                                <input type="text" id="editGuestName" value="${reservation.name || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Email *</label>
                                <input type="email" id="editEmail" value="${reservation.email || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Phone *</label>
                                <input type="tel" id="editPhone" value="${reservation.phone || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reservation Details -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üè°</span> Reservation Details
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Cottage(s) *</label>
                                <input type="text" id="editCottage" value="${reservation.cottage || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Check-In Date *</label>
                                <input type="date" id="editCheckIn" value="${reservation.checkIn || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Check-Out Date *</label>
                                <input type="date" id="editCheckOut" value="${reservation.checkOut || ''}" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Guest Details -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üë•</span> Guest Details
                        </h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Adults</label>
                                <input type="number" id="editAdults" value="${reservation.adults || 2}" min="1" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Children</label>
                                <input type="number" id="editChildren" value="${reservation.children || 0}" min="0" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #555;">Pets</label>
                                <input type="number" id="editPets" value="${reservation.pets || 0}" min="0" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Special Requests -->
                    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 20px 0; color: #333; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üìù</span> Special Requests
                        </h3>
                        <textarea id="editNotes" rows="4" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; font-family: inherit; resize: vertical; transition: all 0.3s ease;" onfocus="this.style.borderColor='#4facfe';" onblur="this.style.borderColor='#ddd';" placeholder="Any special requests or notes...">${reservation.notes || ''}</textarea>
                    </div>
                    
                    <!-- Live Price Calculation -->
                    <div id="editPricePreview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 12px; margin-bottom: 20px; color: white; box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);">
                        <h3 style="margin: 0 0 15px 0; font-size: 1.3rem; display: flex; align-items: center; gap: 10px;">
                            <span>üí∞</span> Updated Price Estimate
                        </h3>
                        <div id="editPriceBreakdown" style="background: rgba(255, 255, 255, 0.15); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px); margin-bottom: 15px; font-size: 0.95rem; line-height: 1.8;">
                            <div style="text-align: center; opacity: 0.8;">Select dates and cottage to see price</div>
                        </div>
                        <div style="text-align: center; font-size: 2rem; font-weight: 700;" id="editTotalPrice">
                            $0.00
                        </div>
                        <div style="text-align: center; margin-top: 8px; font-size: 0.85rem; opacity: 0.9;">
                            <span id="editPriceNights">0 nights</span> ‚Ä¢ <span id="editPriceSeason">Season TBD</span>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button type="button" onclick="saveReservationChanges(${index})" style="flex: 2; min-width: 200px; background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; box-shadow: 0 5px 15px rgba(56, 239, 125, 0.3); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 20px rgba(56, 239, 125, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 5px 15px rgba(56, 239, 125, 0.3)';">
                            ‚úì Save Changes
                        </button>
                        <button type="button" onclick="closeEditModal()" style="flex: 1; min-width: 150px; background: #95a5a6; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#7f8c8d';" onmouseout="this.style.background='#95a5a6';">
                            Cancel
                        </button>
                    </div>
                </form>
            `;
            
            // Show edit modal
            document.getElementById('editReservationModalContent').innerHTML = modalContent;
            document.getElementById('editReservationModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // Add event listeners for real-time price updates
            setTimeout(() => {
                const inputs = ['editCottage', 'editCheckIn', 'editCheckOut', 'editAdults', 'editChildren', 'editPets'];
                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', updateEditPrice);
                        input.addEventListener('change', updateEditPrice);
                    }
                });
                
                // Calculate initial price
                updateEditPrice();
            }, 100);
        }
        
        // Initialize price calculation storage
        if (typeof updateEditPrice === 'undefined') {
            updateEditPrice = function() {};
        }
        updateEditPrice.lastCalculatedPrice = 0;
        updateEditPrice.lastCalculatedNights = 0;
        updateEditPrice.lastCalculatedSeason = 'winter';
        
        // Get cottage data by name (checks reservation data first, then defaults)
        function getCottageByName(name) {
            // Normalize cottage name (remove "The " prefix and trim)
            const normalizedName = name.replace(/^The\s+/i, '').trim();
            
            // Try to get pricing from original reservation if editing
            if (typeof editReservation !== 'undefined' && editReservation.originalReservation && editReservation.originalReservation.cottagesPricing) {
                const cottageData = editReservation.originalReservation.cottagesPricing.find(c => {
                    const storedName = c.name.replace(/^The\s+/i, '').trim();
                    return storedName.toLowerCase() === normalizedName.toLowerCase();
                });
                if (cottageData) {
                    return { name: cottageData.name, pricing: cottageData.pricing };
                }
            }
            
            // Default cottage pricing map (with various name formats)
            const cottageMap = {
                'Villa': { name: 'Villa', pricing: { spring: 175, summer: 225, fall: 175, winter: 150 } },
                'The Villa': { name: 'Villa', pricing: { spring: 175, summer: 225, fall: 175, winter: 150 } },
                'Brown Camp': { name: 'Brown Camp', pricing: { spring: 200, summer: 250, fall: 200, winter: 175 } },
                'The Brown Camp': { name: 'Brown Camp', pricing: { spring: 200, summer: 250, fall: 200, winter: 175 } },
                'Shanty': { name: 'Shanty', pricing: { spring: 175, summer: 225, fall: 175, winter: 150 } },
                'The Shanty': { name: 'Shanty', pricing: { spring: 175, summer: 225, fall: 175, winter: 150 } },
                'Bunkhouse': { name: 'Bunkhouse', pricing: { spring: 75, summer: 100, fall: 75, winter: 60 } },
                'The Bunkhouse': { name: 'Bunkhouse', pricing: { spring: 75, summer: 100, fall: 75, winter: 60 } }
            };
            
            // Try exact match first, then normalized match
            if (cottageMap[name]) {
                return cottageMap[name];
            }
            
            // Try normalized name
            if (cottageMap[normalizedName]) {
                return cottageMap[normalizedName];
            }
            
            // Try case-insensitive match
            const matchingKey = Object.keys(cottageMap).find(key => 
                key.toLowerCase() === name.toLowerCase() || 
                key.toLowerCase() === normalizedName.toLowerCase()
            );
            
            return matchingKey ? cottageMap[matchingKey] : null;
        }
        
        // Update price in edit modal (uses global ADULT_RATE, CHILD_RATE, PET_RATE, TAX_RATE)
        updateEditPrice = function() {
            const cottageInput = document.getElementById('editCottage');
            const checkInInput = document.getElementById('editCheckIn');
            const checkOutInput = document.getElementById('editCheckOut');
            const adultsInput = document.getElementById('editAdults');
            const childrenInput = document.getElementById('editChildren');
            const petsInput = document.getElementById('editPets');
            
            if (!cottageInput || !checkInInput || !checkOutInput) return;
            
            const cottageNames = cottageInput.value.trim();
            const checkIn = checkInInput.value;
            const checkOut = checkOutInput.value;
            const adults = parseInt(adultsInput?.value) || 2;
            const children = parseInt(childrenInput?.value) || 0;
            const pets = parseInt(petsInput?.value) || 0;
            
            const breakdownDiv = document.getElementById('editPriceBreakdown');
            const totalDiv = document.getElementById('editTotalPrice');
            const nightsSpan = document.getElementById('editPriceNights');
            const seasonSpan = document.getElementById('editPriceSeason');
            
            if (!checkIn || !checkOut || !cottageNames) {
                breakdownDiv.innerHTML = '<div style="text-align: center; opacity: 0.8;">Select dates and cottage to see price</div>';
                totalDiv.textContent = '$0.00';
                nightsSpan.textContent = '0 nights';
                seasonSpan.textContent = 'Season TBD';
                return;
            }
            
            const checkInDate = new Date(checkIn + 'T00:00:00');
            const checkOutDate = new Date(checkOut + 'T00:00:00');
            
            if (checkOutDate <= checkInDate) {
                breakdownDiv.innerHTML = '<div style="text-align: center; opacity: 0.8; color: #ffcccc;">‚ö†Ô∏è Check-out must be after check-in</div>';
                totalDiv.textContent = '$0.00';
                return;
            }
            
            // Calculate nights (will be used as default, may be overridden by individual cottage dates)
            let nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            
            // Parse cottage names (handle multiple cottages separated by +, &, or comma)
            const cottageList = cottageNames.split(/[+&,]/).map(c => c.trim()).filter(c => c);
            
            const seasonEmojis = { spring: 'üå∏', summer: '‚òÄÔ∏è', fall: 'üçÇ', winter: '‚ùÑÔ∏è' };
            const seasonNames = { spring: 'Spring', summer: 'Summer', fall: 'Fall', winter: 'Winter' };
            
            // Calculate cottage charges (handle individual dates if available)
            let cottageTotalPrice = 0;
            let breakdownHTML = '<div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.2);"><strong style="font-size: 1.05rem;">üè° Cottage Charges</strong></div>';
            let maxNightsForGuests = nights; // Track longest stay for guest charges
            
            // Count nights per season
            const seasonCounts = { spring: 0, summer: 0, fall: 0, winter: 0 };
            for (let d = new Date(checkInDate); d < checkOutDate; d.setDate(d.getDate() + 1)) {
                const season = getSeason(new Date(d));
                seasonCounts[season]++;
            }
            
            cottageList.forEach(cottageName => {
                const cottage = getCottageByName(cottageName);
                if (!cottage) {
                    breakdownHTML += `<div style="opacity: 0.8; margin: 5px 0;">‚ö†Ô∏è Unknown: ${cottageName}</div>`;
                    return;
                }
                
                let cottageTotal = 0;
                const cottageSeasons = [];
                
                for (const season in seasonCounts) {
                    if (seasonCounts[season] > 0) {
                        const nightsInSeason = seasonCounts[season];
                        const rate = cottage.pricing[season];
                        const seasonTotal = rate * nightsInSeason;
                        cottageTotal += seasonTotal;
                        cottageSeasons.push(`${seasonEmojis[season]} $${rate} √ó ${nightsInSeason} = $${seasonTotal}`);
                    }
                }
                
                breakdownHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px;">`;
                breakdownHTML += `<div style="font-weight: 600; margin-bottom: 4px;">${cottage.name}</div>`;
                breakdownHTML += `<div style="font-size: 0.9rem; opacity: 0.95;">${cottageSeasons.join('<br>')}</div>`;
                breakdownHTML += `<div style="font-weight: 600; margin-top: 4px;">Subtotal: $${cottageTotal}</div>`;
                breakdownHTML += `</div>`;
                
                cottageTotalPrice += cottageTotal;
            });
            
            // Calculate guest charges
            const adultCharges = adults * ADULT_RATE * nights;
            const childCharges = children * CHILD_RATE * nights;
            const petCharges = pets * PET_RATE * nights;
            const totalGuestCharges = adultCharges + childCharges + petCharges;
            
            if (totalGuestCharges > 0) {
                breakdownHTML += '<div style="margin: 12px 0; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.2);"><strong style="font-size: 1.05rem;">üë• Guest Charges</strong></div>';
                
                if (adults > 0) breakdownHTML += `<div style="margin: 5px 0;">üë§ ${adults} Adult${adults !== 1 ? 's' : ''} √ó $${ADULT_RATE} √ó ${nights} = $${adultCharges}</div>`;
                if (children > 0) breakdownHTML += `<div style="margin: 5px 0;">üë∂ ${children} Child${children !== 1 ? 'ren' : ''} √ó $${CHILD_RATE} √ó ${nights} = $${childCharges}</div>`;
                if (pets > 0) breakdownHTML += `<div style="margin: 5px 0;">üêæ ${pets} Pet${pets !== 1 ? 's' : ''} √ó $${PET_RATE} √ó ${nights} = $${petCharges}</div>`;
            }
            
            // Calculate subtotal
            const subtotal = cottageTotalPrice + totalGuestCharges;
            
            // Calculate tax (8.5%)
            const taxAmount = subtotal * TAX_RATE;
            const grandTotal = subtotal + taxAmount;
            
            breakdownHTML += '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">';
            breakdownHTML += `<div style="display: flex; justify-content: space-between; margin: 5px 0;"><span>Subtotal:</span><span style="font-weight: 600;">$${subtotal.toFixed(2)}</span></div>`;
            breakdownHTML += `<div style="display: flex; justify-content: space-between; margin: 5px 0;"><span>üèõÔ∏è Tax (8.5%):</span><span style="font-weight: 600;">$${taxAmount.toFixed(2)}</span></div>`;
            breakdownHTML += '</div>';
            
            // Update display
            breakdownDiv.innerHTML = breakdownHTML;
            totalDiv.textContent = `$${grandTotal.toFixed(2)}`;
            nightsSpan.textContent = `${nights} night${nights !== 1 ? 's' : ''}`;
            
            // Determine dominant season
            let dominantSeason = 'winter';
            let maxNights = 0;
            for (const season in seasonCounts) {
                if (seasonCounts[season] > maxNights) {
                    maxNights = seasonCounts[season];
                    dominantSeason = season;
                }
            }
            seasonSpan.textContent = seasonEmojis[dominantSeason] + ' ' + seasonNames[dominantSeason];
            
            // Store calculated price for saving
            updateEditPrice.lastCalculatedPrice = grandTotal;
            updateEditPrice.lastCalculatedNights = nights;
            updateEditPrice.lastCalculatedSeason = dominantSeason;
        };
        
        // Save reservation changes
        function saveReservationChanges(index) {
            
            const cottageNames = cottageInput.value.trim();
            const checkIn = checkInInput.value;
            const checkOut = checkOutInput.value;
            const adults = parseInt(adultsInput?.value) || 2;
            const children = parseInt(childrenInput?.value) || 0;
            const pets = parseInt(petsInput?.value) || 0;
            
            const breakdownDiv = document.getElementById('editPriceBreakdown');
            const totalDiv = document.getElementById('editTotalPrice');
            const nightsSpan = document.getElementById('editPriceNights');
            const seasonSpan = document.getElementById('editPriceSeason');
            
            if (!checkIn || !checkOut || !cottageNames) {
                breakdownDiv.innerHTML = '<div style="text-align: center; opacity: 0.8;">Select dates and cottage to see price</div>';
                totalDiv.textContent = '$0.00';
                nightsSpan.textContent = '0 nights';
                seasonSpan.textContent = 'Season TBD';
                return;
            }
            
            const checkInDate = new Date(checkIn + 'T00:00:00');
            const checkOutDate = new Date(checkOut + 'T00:00:00');
            
            if (checkOutDate <= checkInDate) {
                breakdownDiv.innerHTML = '<div style="text-align: center; opacity: 0.8; color: #ffcccc;">‚ö†Ô∏è Check-out must be after check-in</div>';
                totalDiv.textContent = '$0.00';
                return;
            }
            
            // Calculate nights
            const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            
            // Parse cottage names (handle multiple cottages separated by +, &, or comma)
            const cottageList = cottageNames.split(/[+&,]/).map(c => c.trim()).filter(c => c);
            
            // Count nights per season
            const seasonCounts = { spring: 0, summer: 0, fall: 0, winter: 0 };
            const seasonEmojis = { spring: 'üå∏', summer: '‚òÄÔ∏è', fall: 'üçÇ', winter: '‚ùÑÔ∏è' };
            const seasonNames = { spring: 'Spring', summer: 'Summer', fall: 'Fall', winter: 'Winter' };
            
            for (let d = new Date(checkInDate); d < checkOutDate; d.setDate(d.getDate() + 1)) {
                const season = getSeason(new Date(d));
                seasonCounts[season]++;
            }
            
            // Calculate cottage charges
            let cottageTotalPrice = 0;
            let breakdownHTML = '<div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.2);"><strong style="font-size: 1.05rem;">üè° Cottage Charges</strong></div>';
            
            cottageList.forEach(cottageName => {
                const cottage = getCottageByName(cottageName);
                if (!cottage) {
                    breakdownHTML += `<div style="opacity: 0.8; margin: 5px 0;">‚ö†Ô∏è Unknown: ${cottageName}</div>`;
                    return;
                }
                
                let cottageTotal = 0;
                const cottageSeasons = [];
                
                for (const season in seasonCounts) {
                    if (seasonCounts[season] > 0) {
                        const nightsInSeason = seasonCounts[season];
                        const rate = cottage.pricing[season];
                        const seasonTotal = rate * nightsInSeason;
                        cottageTotal += seasonTotal;
                        cottageSeasons.push(`${seasonEmojis[season]} $${rate} √ó ${nightsInSeason} = $${seasonTotal}`);
                    }
                }
                
                breakdownHTML += `<div style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.1); border-radius: 6px;">`;
                breakdownHTML += `<div style="font-weight: 600; margin-bottom: 4px;">${cottage.name}</div>`;
                breakdownHTML += `<div style="font-size: 0.9rem; opacity: 0.95;">${cottageSeasons.join('<br>')}</div>`;
                breakdownHTML += `<div style="font-weight: 600; margin-top: 4px;">Subtotal: $${cottageTotal}</div>`;
                breakdownHTML += `</div>`;
                
                cottageTotalPrice += cottageTotal;
            });
            
            // Calculate guest charges
            const adultCharges = adults * ADULT_RATE * nights;
            const childCharges = children * CHILD_RATE * nights;
            const petCharges = pets * PET_RATE * nights;
            const totalGuestCharges = adultCharges + childCharges + petCharges;
            
            if (totalGuestCharges > 0) {
                breakdownHTML += '<div style="margin: 12px 0; padding: 12px 0; border-top: 1px solid rgba(255,255,255,0.2);"><strong style="font-size: 1.05rem;">üë• Guest Charges</strong></div>';
                
                if (adults > 0) breakdownHTML += `<div style="margin: 5px 0;">üë§ ${adults} Adult${adults !== 1 ? 's' : ''} √ó $${ADULT_RATE} √ó ${nights} = $${adultCharges}</div>`;
                if (children > 0) breakdownHTML += `<div style="margin: 5px 0;">üë∂ ${children} Child${children !== 1 ? 'ren' : ''} √ó $${CHILD_RATE} √ó ${nights} = $${childCharges}</div>`;
                if (pets > 0) breakdownHTML += `<div style="margin: 5px 0;">üêæ ${pets} Pet${pets !== 1 ? 's' : ''} √ó $${PET_RATE} √ó ${nights} = $${petCharges}</div>`;
            }
            
            // Calculate subtotal
            const subtotal = cottageTotalPrice + totalGuestCharges;
            
            // Calculate tax (8.5%)
            const taxAmount = subtotal * TAX_RATE;
            const grandTotal = subtotal + taxAmount;
            
            breakdownHTML += '<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.2);">';
            breakdownHTML += `<div style="display: flex; justify-content: space-between; margin: 5px 0;"><span>Subtotal:</span><span style="font-weight: 600;">$${subtotal.toFixed(2)}</span></div>`;
            breakdownHTML += `<div style="display: flex; justify-content: space-between; margin: 5px 0;"><span>üèõÔ∏è Tax (8.5%):</span><span style="font-weight: 600;">$${taxAmount.toFixed(2)}</span></div>`;
            breakdownHTML += '</div>';
            
            // Update display
            breakdownDiv.innerHTML = breakdownHTML;
            totalDiv.textContent = `$${grandTotal.toFixed(2)}`;
            nightsSpan.textContent = `${nights} night${nights !== 1 ? 's' : ''}`;
            
            // Determine dominant season
            let dominantSeason = 'winter';
            let maxNights = 0;
            for (const season in seasonCounts) {
                if (seasonCounts[season] > maxNights) {
                    maxNights = seasonCounts[season];
                    dominantSeason = season;
                }
            }
            seasonSpan.textContent = seasonEmojis[dominantSeason] + ' ' + seasonNames[dominantSeason];
            
            // Store calculated price for saving
            updateEditPrice.lastCalculatedPrice = grandTotal;
            updateEditPrice.lastCalculatedNights = nights;
            updateEditPrice.lastCalculatedSeason = dominantSeason;
        }
        
        // Save reservation changes
        function saveReservationChanges(index) {
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            
            if (!reservations[index]) {
                alert('‚ö†Ô∏è Reservation not found.');
                return;
            }
            
            // Get form values
            const name = document.getElementById('editGuestName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const cottage = document.getElementById('editCottage').value.trim();
            const checkIn = document.getElementById('editCheckIn').value;
            const checkOut = document.getElementById('editCheckOut').value;
            const adults = parseInt(document.getElementById('editAdults').value) || 2;
            const children = parseInt(document.getElementById('editChildren').value) || 0;
            const pets = parseInt(document.getElementById('editPets').value) || 0;
            const notes = document.getElementById('editNotes').value.trim();
            
            // Validate required fields
            if (!name || !email || !phone || !cottage || !checkIn || !checkOut) {
                alert('‚ö†Ô∏è Please fill in all required fields.');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ö†Ô∏è Please enter a valid email address.');
                return;
            }
            
            // Validate dates
            const checkInDate = new Date(checkIn);
            const checkOutDate = new Date(checkOut);
            
            if (checkOutDate <= checkInDate) {
                alert('‚ö†Ô∏è Check-out date must be after check-in date.');
                return;
            }
            
            // Calculate nights
            const nights = Math.ceil((checkOutDate - checkInDate) / (1000 * 60 * 60 * 24));
            
            // Get calculated price from live preview
            const estimatedPrice = updateEditPrice.lastCalculatedPrice || 0;
            const season = updateEditPrice.lastCalculatedSeason || 'winter';
            
            // Update reservation
            reservations[index] = {
                ...reservations[index],
                name: name,
                email: email,
                phone: phone,
                cottage: cottage,
                checkIn: checkIn,
                checkOut: checkOut,
                adults: adults,
                children: children,
                pets: pets,
                guests: `${adults} Adult${adults !== 1 ? 's' : ''}${children > 0 ? `, ${children} Child${children !== 1 ? 'ren' : ''}` : ''}${pets > 0 ? `, ${pets} Pet${pets !== 1 ? 's' : ''}` : ''}`,
                notes: notes,
                nights: nights,
                season: season,
                estimatedPrice: estimatedPrice,
                updatedAt: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // Close modal and refresh
            closeEditModal();
            loadReservations();
            
            // Show success message
            alert('‚úÖ Reservation updated successfully!');
        }
        
        // Close edit modal
        function closeEditModal() {
            document.getElementById('editReservationModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Close edit modal when clicking outside
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('editReservationModal');
            if (e.target === modal) {
                closeEditModal();
            }
        });

        // Delete reservation
        function deleteReservation(index) {
            if (!confirm('‚ö†Ô∏è Are you sure you want to delete this reservation?\n\nThis action cannot be undone.')) {
                return;
            }
            
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            reservations.splice(index, 1);
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            alert('‚úÖ Reservation deleted successfully!');
            loadReservations();
        }

        // Listen for admin mode changes
        window.addEventListener('storage', function(e) {
            if (e.key === 'adminLoggedIn') {
                checkAdminStatus();
                if (adminLoggedIn) {
                    showAdminReservations();
                } else {
                    const adminList = document.getElementById('adminReservationsList');
                    if (adminList) adminList.style.display = 'none';
                }
            }
        });

        // Add animations for modal and other elements
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-20px); }
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes slideUp {
                from { 
                    opacity: 0;
                    transform: translateY(30px);
                }
                to { 
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // ===== GUEST SELECTION FUNCTIONALITY =====
        let numAdults = 2;
        let numChildren = 0;
        let numPets = 0;

        // Show guest selection section
        function showGuestSelection() {
            // Hide cottage selection
            document.getElementById('cottageSelectionSection').style.display = 'none';
            document.getElementById('continueBookingSection').style.display = 'none';
            
            // Show guest section
            document.getElementById('guestSection').style.display = 'block';
            
            // Update cottage summary
            const summaryDiv = document.getElementById('guestCottagesSummary');
            const cottageNames = selectedCottages.map(c => c.name).join(', ');
            const totalCapacity = selectedCottages.reduce((sum, c) => sum + c.maxGuests, 0);
            summaryDiv.innerHTML = `
                <strong style="font-size: 1.2rem;">Selected Cottages:</strong> ${cottageNames}<br>
                <span style="opacity: 0.9;">Total Capacity: Up to ${totalCapacity} guests</span>
            `;
            
            // Initialize pricing
            updateGuestPricing();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update guest pricing display
        function updateGuestPricing() {
            numAdults = parseInt(document.getElementById('numAdults').value) || 0;
            numChildren = parseInt(document.getElementById('numChildren').value) || 0;
            numPets = parseInt(document.getElementById('numPets').value) || 0;

            const adultCost = numAdults * ADULT_RATE;
            const childCost = numChildren * CHILD_RATE;
            const petCost = numPets * PET_RATE;
            const totalPerNight = adultCost + childCost + petCost;

            const breakdown = document.getElementById('guestPriceBreakdown');
            let breakdownHTML = '';
            
            if (numAdults > 0) {
                breakdownHTML += `üë§ ${numAdults} Adult${numAdults !== 1 ? 's' : ''} √ó $${ADULT_RATE} = $${adultCost}<br>`;
            }
            if (numChildren > 0) {
                breakdownHTML += `üë∂ ${numChildren} Child${numChildren !== 1 ? 'ren' : ''} √ó $${CHILD_RATE} = $${childCost}<br>`;
            }
            if (numPets > 0) {
                breakdownHTML += `üêæ ${numPets} Pet${numPets !== 1 ? 's' : ''} √ó $${PET_RATE} = $${petCost}<br>`;
            }

            breakdown.innerHTML = breakdownHTML || '<span style="color: #999; font-style: italic;">No additional charges</span>';
            document.getElementById('guestTotalPerNight').textContent = `$${totalPerNight}`;
        }

        // ===== CALENDAR FUNCTIONALITY =====
        // Track all selected dates as a Set (ISO strings)
        let selectedDateSet = new Set();
        // Track range selection state
        let rangeStartDate = null;
        // Track date selection mode for multiple cottages
        let multipleCottageMode = 'same'; // 'same' or 'individual'
        let individualCottageDates = {}; // Store dates per cottage for individual mode
        let currentCottageIndex = 0; // Track which cottage we're selecting dates for
        
        // Handle same dates for all cottages
        function setSameDatesForAll() {
            multipleCottageMode = 'same';
            document.getElementById('multipleCottagesOption').style.display = 'none';
            // Reset the calendar summary to not show individual cottage
            const summaryDiv = document.getElementById('calendarCottagesSummary');
            const cottageNames = selectedCottages.map(c => c.name).join(', ');
            summaryDiv.innerHTML = `<strong>Selected Cottages:</strong> ${cottageNames}<br><span style="opacity: 0.9; font-size: 0.95rem;">Selecting dates for all cottages</span>`;
        }

        // Show calendar for individual cottage selection
        function showIndividualCottageCalendar() {
            const currentCottage = selectedCottages[currentCottageIndex];
            
            // Update summary to show which cottage we're selecting for
            const summaryDiv = document.getElementById('calendarCottagesSummary');
            
            // Build progress tracker with date counts
            const progressHTML = selectedCottages.map((cottage, idx) => {
                const isCurrent = idx === currentCottageIndex;
                const dates = individualCottageDates[cottage.name];
                const dateCount = dates ? dates.size : 0;
                const hasAllDates = dateCount > 0;
                
                let status = '';
                let style = '';
                
                if (isCurrent) {
                    status = `<span style="color: #4facfe; font-weight: 700;">‚ö° CURRENT</span>`;
                    style = 'background: rgba(79, 172, 254, 0.1); border: 2px solid #4facfe;';
                } else if (hasAllDates) {
                    const nights = dateCount > 1 ? dateCount - 1 : 1;
                    status = `<span style="color: #4caf50; font-weight: 700;">‚úì ${nights} night${nights !== 1 ? 's' : ''}</span>`;
                    style = 'background: rgba(76, 175, 80, 0.05); border: 2px solid #4caf50;';
                } else {
                    status = `<span style="opacity: 0.4; font-weight: 600;">‚óã Pending</span>`;
                    style = 'background: #f5f5f5; border: 2px solid #ddd;';
                }
                
                return `
                    <div style="padding: 10px 15px; border-radius: 8px; ${style} margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-weight: 600;">${cottage.name}</span>
                        ${status}
                    </div>
                `;
            }).join('');
            
            summaryDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr auto; gap: 25px; align-items: start;">
                    <div>
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
                            <h3 style="margin: 0 0 8px 0; font-size: 1.5rem;">üìç ${currentCottage.name}</h3>
                            <div style="opacity: 0.95; font-size: 1rem;">Cottage ${currentCottageIndex + 1} of ${selectedCottages.length} ‚Ä¢ Sleeps ${currentCottage.maxGuests} guests</div>
                        </div>
                        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 15px; border-radius: 6px;">
                            <strong>üí° Tip:</strong> Click once to start a range, click again to end it. Click any selected date to remove it.
                        </div>
                    </div>
                    <div style="min-width: 250px;">
                        <h4 style="margin: 0 0 12px 0; color: #333; font-size: 1.1rem;">Progress Tracker</h4>
                        ${progressHTML}
                    </div>
                </div>
            `;
            
            // Load this cottage's previously selected dates
            selectedDateSet = new Set(individualCottageDates[currentCottage.name]);
            rangeStartDate = null;
            
            // Show/hide navigation buttons
            document.getElementById('individualCottageNav').style.display = 'flex';
            document.getElementById('continueToBookingBtn').style.display = 'none';
            
            // Enable/disable previous button
            const prevBtn = document.getElementById('prevCottageBtn');
            if (currentCottageIndex === 0) {
                prevBtn.disabled = true;
                prevBtn.style.opacity = '0.5';
                prevBtn.style.cursor = 'not-allowed';
            } else {
                prevBtn.disabled = false;
                prevBtn.style.opacity = '1';
                prevBtn.style.cursor = 'pointer';
            }
            
            // Update next button text based on position
            const nextBtn = document.getElementById('nextCottageBtn');
            if (currentCottageIndex === selectedCottages.length - 1) {
                nextBtn.innerHTML = '‚úì Complete Selection';
                nextBtn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
            } else {
                nextBtn.innerHTML = `Next: ${selectedCottages[currentCottageIndex + 1].name} ‚Üí`;
                nextBtn.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
            }
            
            // Add clear dates button functionality
            const clearBtn = document.getElementById('clearCottageDatesBtn');
            if (clearBtn) {
                clearBtn.style.display = selectedDateSet.size > 0 ? 'inline-block' : 'none';
            }
            
            // Render calendar
            renderCalendar();
            updateSelectedDatesDisplay();
            
            // Scroll to calendar
            setTimeout(() => {
                document.getElementById('calendarSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Clear all dates for current cottage
        function clearCurrentCottageDates() {
            if (confirm('üóëÔ∏è Clear all selected dates for this cottage?\n\nThis will remove all dates you\'ve selected for ' + selectedCottages[currentCottageIndex].name)) {
                selectedDateSet.clear();
                rangeStartDate = null;
                renderCalendar();
                updateSelectedDatesDisplay();
            }
        }
        
        // Save current cottage dates and move to next
        function saveAndNextCottage() {
            const currentCottage = selectedCottages[currentCottageIndex];
            
            if (selectedDateSet.size === 0) {
                const skip = confirm(`‚ö†Ô∏è No dates selected for ${currentCottage.name}\n\nYou must select at least one date for each cottage. Please select dates before continuing.`);
                return;
            }
            
            // Validate dates form a continuous range
            const dates = Array.from(selectedDateSet).sort();
            if (dates.length > 1) {
                const firstDate = new Date(dates[0] + 'T00:00:00');
                const lastDate = new Date(dates[dates.length - 1] + 'T00:00:00');
                const expectedDays = Math.ceil((lastDate - firstDate) / (1000 * 60 * 60 * 24)) + 1;
                
                if (dates.length !== expectedDays) {
                    alert('‚ö†Ô∏è Please select a continuous date range.\n\nThere are gaps in your selected dates. Make sure all dates between check-in and check-out are selected.');
                    return;
                }
            }
            
            // Save current cottage's dates
            individualCottageDates[currentCottage.name] = new Set(selectedDateSet);
            
            // Move to next cottage or finish
            currentCottageIndex++;
            
            if (currentCottageIndex < selectedCottages.length) {
                // More cottages to select
                showIndividualCottageCalendar();
            } else {
                // All cottages have dates, enable continue button
                document.getElementById('individualCottageNav').style.display = 'none';
                document.getElementById('continueToBookingBtn').style.display = 'block';
                document.getElementById('continueToBookingBtn').disabled = false;
                document.getElementById('continueToBookingBtn').style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                document.getElementById('continueToBookingBtn').style.cursor = 'pointer';
                
                // Combine all dates for final display
                selectedDateSet = new Set();
                Object.values(individualCottageDates).forEach(dateSet => {
                    dateSet.forEach(date => selectedDateSet.add(date));
                });
                
                // Build detailed completion summary
                const completionHTML = selectedCottages.map(cottage => {
                    const dates = Array.from(individualCottageDates[cottage.name]).sort();
                    const checkIn = new Date(dates[0] + 'T00:00:00');
                    const checkOut = new Date(dates[dates.length - 1] + 'T00:00:00');
                    const nights = dates.length > 1 ? dates.length - 1 : 1;
                    
                    return `
                        <div style="background: white; padding: 15px; border-radius: 10px; border: 2px solid #4caf50; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong style="font-size: 1.1rem; color: #333;">${cottage.name}</strong>
                                <span style="background: #4caf50; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">
                                    ‚úì ${nights} Night${nights !== 1 ? 's' : ''}
                                </span>
                            </div>
                            <div style="color: #666; font-size: 0.95rem;">
                                üìÖ ${checkIn.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} ‚Üí 
                                ${checkOut.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update summary to show completion
                const summaryDiv = document.getElementById('calendarCottagesSummary');
                summaryDiv.innerHTML = `
                    <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px;">
                        <h2 style="margin: 0 0 10px 0; font-size: 1.8rem; display: flex; align-items: center; gap: 12px;">
                            <span>üéâ</span> All Cottage Dates Selected!
                        </h2>
                        <p style="margin: 0; opacity: 0.95; font-size: 1.05rem;">Review your selections below and click "Review Reservation" to see the final pricing.</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                        <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.2rem;">Your Selected Dates by Cottage:</h3>
                        ${completionHTML}
                        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 15px; border-radius: 6px; margin-top: 15px;">
                            <strong>üí° Note:</strong> The calendar below shows all combined dates from all cottages. Pricing will be calculated individually for each cottage.
                        </div>
                    </div>
                `;
                
                // Show final pricing
                renderCalendar();
                updateSelectedDatesDisplay();
            }
        }

        // Go back to previous cottage
        function previousCottage() {
            if (currentCottageIndex > 0) {
                // Save current dates first (even if empty, to preserve state)
                const currentCottage = selectedCottages[currentCottageIndex];
                individualCottageDates[currentCottage.name] = new Set(selectedDateSet);
                
                // Move back
                currentCottageIndex--;
                
                // Show previous cottage with its saved dates
                showIndividualCottageCalendar();
                
                // Scroll to top for better UX
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Handle individual dates per cottage
        function setIndividualDates() {
            multipleCottageMode = 'individual';
            document.getElementById('multipleCottagesOption').style.display = 'none';
            
            // Initialize individual cottage dates
            individualCottageDates = {};
            selectedCottages.forEach(cottage => {
                individualCottageDates[cottage.name] = new Set();
            });
            
            // Show cottage selector and start with first cottage
            currentCottageIndex = 0;
            showIndividualCottageCalendar();
        }
        
        // Proceed to calendar after guest details filled
        function proceedToCalendar() {
            // Validate form fields
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const adults = parseInt(document.getElementById('numAdults').value);

            if (!firstName || !lastName || !email || !phone || adults < 1) {
                alert('‚ö†Ô∏è Please fill in all required fields before continuing.');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ö†Ô∏è Please enter a valid email address.');
                return;
            }

            // Hide guest section
            document.getElementById('guestSection').style.display = 'none';
            
            // Show calendar
            showAvailabilityCalendar();
        }

        // Show availability calendar
        function showAvailabilityCalendar() {
            // Show calendar
            document.getElementById('calendarSection').style.display = 'block';
            
            // Update cottage summary
            const summaryDiv = document.getElementById('calendarCottagesSummary');
            const cottageNames = selectedCottages.map(c => c.name).join(', ');
            summaryDiv.innerHTML = `<strong>Selected Cottages:</strong> ${cottageNames}`;
            
            // Show multiple cottages option if more than one cottage selected
            const multipleOption = document.getElementById('multipleCottagesOption');
            if (selectedCottages.length > 1) {
                multipleOption.style.display = 'block';
            } else {
                multipleOption.style.display = 'none';
                multipleCottageMode = 'same'; // Force same mode for single cottage
            }
            
            // Reset dates
            selectedStartDate = null;
            selectedEndDate = null;
            selectedDateSet = new Set();
            rangeStartDate = null;
            
            // Load booked dates
            loadBookedDates();
            
            // Render calendar
            renderCalendar();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Set selection mode
        function setCalendarMode(mode) {
            calendarMode = mode === 'single' ? 'single' : 'range';
            // Visual feedback on buttons
            const singleBtn = document.getElementById('modeSingleBtn');
            const rangeBtn = document.getElementById('modeRangeBtn');
            if (calendarMode === 'single') {
                singleBtn.style.filter = 'brightness(1)';
                rangeBtn.style.filter = 'brightness(0.85)';
            } else {
                rangeBtn.style.filter = 'brightness(1)';
                singleBtn.style.filter = 'brightness(0.85)';
            }
            // Re-render to update highlights
            renderCalendar();
            updateSelectedDatesDisplay();
        }
        
        // Back to cottage selection
        function backToCottageSelection() {
            document.getElementById('calendarSection').style.display = 'none';
            document.getElementById('cottageSelectionSection').style.display = 'block';
            document.getElementById('continueBookingSection').style.display = 'block';
        }
        
        // Load booked dates from reservations
        function loadBookedDates() {
            bookedDates = {};
            const reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            
            reservations.forEach(reservation => {
                const cottage = reservation.cottage;
                if (!bookedDates[cottage]) {
                    bookedDates[cottage] = [];
                }
                
                // Add all dates in the reservation range
                const startDate = new Date(reservation.checkIn);
                const endDate = new Date(reservation.checkOut);
                
                for (let d = new Date(startDate); d < endDate; d.setDate(d.getDate() + 1)) {
                    const dateStr = d.toISOString().split('T')[0];
                    bookedDates[cottage].push(dateStr);
                }
            });
        }
        
        // Check if a date is available for selected cottages
        function isDateAvailable(date) {
            const dateStr = formatDateLocal(date);
            
            // Check if ANY of the selected cottages has this date booked
            for (const cottage of selectedCottages) {
                if (bookedDates[cottage.name] && bookedDates[cottage.name].includes(dateStr)) {
                    return false;
                }
            }
            
            return true;
        }
        
        // Render calendar
        function renderCalendar() {
            const monthYear = document.getElementById('calendarMonthYear');
            const grid = document.getElementById('calendarGrid');
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Set month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            monthYear.textContent = `${monthNames[month]} ${year}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Add day headers
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.style.cssText = 'font-weight: 700; text-align: center; padding: 10px; color: var(--primary-color); font-size: 0.9rem;';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and days in month
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                grid.appendChild(emptyCell);
            }
            
            // Determine arrival and departure dates
            let arrivalDate = null;
            let departureDate = null;
            
            const sortedDates = Array.from(selectedDateSet).sort();
            if (sortedDates.length > 0) {
                arrivalDate = sortedDates[0];
                departureDate = sortedDates[sortedDates.length - 1];
            }
            
            // Add day cells
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDateLocal(date);
                const isPast = date < today;
                const isAvailable = !isPast && isDateAvailable(date);
                const isSelected = selectedDateSet.has(dateStr);
                const isArrival = dateStr === arrivalDate;
                const isDeparture = dateStr === departureDate;
                
                const dayCell = document.createElement('div');
                dayCell.style.cssText = `
                    position: relative;
                    padding: 15px;
                    text-align: center;
                    border-radius: 8px;
                    font-weight: 600;
                    cursor: ${isPast || !isAvailable ? 'not-allowed' : (isSelected ? 'pointer' : 'pointer')};
                    transition: all 0.3s ease;
                    border: 2px solid transparent;
                    overflow: hidden;
                `;
                
                // Create text container
                const textSpan = document.createElement('span');
                textSpan.textContent = day;
                textSpan.style.cssText = 'position: relative; z-index: 2;';
                
                // Style based on status
                if (isPast) {
                    dayCell.style.background = '#e0e0e0';
                    dayCell.style.color = '#999';
                } else if (!isAvailable) {
                    dayCell.style.background = 'linear-gradient(135deg, #ee0979 0%, #ff6a00 100%)';
                    dayCell.style.color = 'white';
                } else if (isSelected) {
                    // Check if this is arrival or departure for half-day styling
                    if (isArrival && isDeparture && arrivalDate === departureDate) {
                        // Single day booking - full day
                        dayCell.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                        dayCell.style.color = 'white';
                        dayCell.style.border = '2px solid #0088cc';
                    } else if (isArrival) {
                        // Arrival day - left half lighter (arriving), right half full (occupied)
                        dayCell.style.background = 'linear-gradient(to right, rgba(79, 172, 254, 0.4) 0%, rgba(79, 172, 254, 0.4) 50%, #4facfe 50%, #00f2fe 100%)';
                        dayCell.style.color = 'white';
                        dayCell.style.border = '2px solid #0088cc';
                    } else if (isDeparture) {
                        // Departure day - left half full (occupied), right half lighter (leaving)
                        dayCell.style.background = 'linear-gradient(to right, #4facfe 0%, #00f2fe 50%, rgba(0, 242, 254, 0.4) 50%, rgba(0, 242, 254, 0.4) 100%)';
                        dayCell.style.color = 'white';
                        dayCell.style.border = '2px solid #0088cc';
                    } else {
                        // Full day in between
                        dayCell.style.background = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
                        dayCell.style.color = 'white';
                        dayCell.style.border = '2px solid #0088cc';
                    }
                } else {
                    dayCell.style.background = 'white';
                    dayCell.style.border = '2px solid #ddd';
                }
                
                dayCell.appendChild(textSpan);
                
                // Add hover effect for available dates
                if (!isPast && isAvailable) {
                    dayCell.addEventListener('mouseenter', () => {
                        if (!isSelected) {
                            dayCell.style.background = 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)';
                            dayCell.style.transform = 'scale(1.1)';
                        }
                    });
                    dayCell.addEventListener('mouseleave', () => {
                        if (!isSelected) {
                            dayCell.style.background = 'white';
                            dayCell.style.transform = 'scale(1)';
                        }
                    });
                }
                
                // Add click handler for all dates (available or selected)
                if (!isPast) {
                    if (isSelected) {
                        // Can remove selected dates
                        dayCell.addEventListener('click', () => selectDate(date));
                    } else if (isAvailable) {
                        // Can add available dates
                        dayCell.addEventListener('click', () => selectDate(date));
                    }
                }
                
                grid.appendChild(dayCell);
            }
        }
        
        // Check if date is in selected range
        function isDateInRange(date) {
            if (!selectedStartDate) return false;
            if (!selectedEndDate) return date.toDateString() === selectedStartDate.toDateString();
            
            return date >= selectedStartDate && date <= selectedEndDate;
        }
        
        // Select a date
        function selectDate(date) {
            const iso = formatDateLocal(date);
            
            // If date is already selected, remove it (single click removal)
            if (selectedDateSet.has(iso)) {
                selectedDateSet.delete(iso);
                // Also reset range if we're removing a date
                if (rangeStartDate && formatDateLocal(rangeStartDate) === iso) {
                    rangeStartDate = null;
                }
                renderCalendar();
                updateSelectedDatesDisplay();
                return;
            }
            
            // Date is not selected - use range fill logic to add
            if (!rangeStartDate) {
                // First click - start range selection
                rangeStartDate = date;
                selectedDateSet.add(iso);
            } else {
                // Second click - complete range
                const start = rangeStartDate < date ? rangeStartDate : date;
                const end = rangeStartDate < date ? date : rangeStartDate;
                
                // Check if all dates in range are available
                let allAvailable = true;
                const datesToAdd = [];
                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    const checkIso = formatDateLocal(d);
                    if (!selectedDateSet.has(checkIso) && !isDateAvailable(d)) {
                        allAvailable = false;
                        break;
                    }
                    datesToAdd.push(formatDateLocal(new Date(d)));
                }
                
                if (allAvailable) {
                    // Add all dates in range
                    datesToAdd.forEach(dateStr => selectedDateSet.add(dateStr));
                    rangeStartDate = null; // Reset for next range
                } else {
                    alert('‚ùå Cannot select this date range.\n\nOne or more dates in this range are already booked for your selected cottage(s).');
                    rangeStartDate = null;
                }
            }
            
            renderCalendar();
            updateSelectedDatesDisplay();
        }
        
        // Validate date range is fully available
        function validateDateRange(start, end) {
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                if (!isDateAvailable(d)) {
                    return false;
                }
            }
            return true;
        }
        
        // Update selected dates display
        function updateSelectedDatesDisplay() {
            const display = document.getElementById('selectedDatesDisplay');
            const text = document.getElementById('selectedDatesText');
            const nights = document.getElementById('selectedNights');
            const priceDisplay = document.getElementById('calendarPriceEstimate');
            const continueBtn = document.getElementById('continueToBookingBtn');
            
            const dates = Array.from(selectedDateSet).sort();
            if (dates.length > 0) {
                display.style.display = 'block';
                
                const firstDate = new Date(dates[0] + 'T00:00:00');
                const lastDate = new Date(dates[dates.length - 1] + 'T00:00:00');
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const startStr = firstDate.toLocaleDateString('en-US', options);
                const endStr = lastDate.toLocaleDateString('en-US', options);
                
                // Calculate nights with half-day logic (dates - 1)
                const nightCount = dates.length > 1 ? dates.length - 1 : 1;
                
                text.textContent = dates.length === 1 ? startStr : `${startStr} ‚Üí ${endStr}`;
                nights.textContent = `${nightCount} night${nightCount !== 1 ? 's' : ''}`;
                
                calculateAndShowPrice();
                continueBtn.disabled = false;
                continueBtn.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';
                continueBtn.style.cursor = 'pointer';
            } else {
                display.style.display = 'none';
                priceDisplay.style.display = 'none';
                continueBtn.disabled = true;
                continueBtn.style.background = '#95a5a6';
                continueBtn.style.cursor = 'not-allowed';
            }
        }
        
        // Calculate and show price estimate with seasonal breakdown
        function calculateAndShowPrice() {
            const priceDisplay = document.getElementById('calendarPriceEstimate');
            const breakdown = document.getElementById('calendarPriceBreakdown');
            const total = document.getElementById('calendarTotalPrice');
            const dates = Array.from(selectedDateSet).sort().map(d => new Date(d + 'T00:00:00'));
            if (dates.length === 0) { priceDisplay.style.display = 'none'; return; }
            
            const seasonEmojis = { spring: 'üå∏', summer: '‚òÄÔ∏è', fall: 'üçÇ', winter: '‚ùÑÔ∏è' };
            const seasonNames = { spring: 'Spring', summer: 'Summer', fall: 'Fall', winter: 'Winter' };
            
            let totalPrice = 0;
            let breakdownHTML = '';
            let totalNights = 0;
            
            // Calculate for each cottage (handling individual mode separately)
            selectedCottages.forEach(cottage => {
                let cottageTotal = 0;
                let cottageDetails = [];
                let cottageDates = [];
                let cottageNights = 0;
                
                // Get dates for this specific cottage
                if (multipleCottageMode === 'individual' && individualCottageDates[cottage.name]) {
                    // Use individual dates for this cottage
                    cottageDates = Array.from(individualCottageDates[cottage.name]).sort().map(d => new Date(d + 'T00:00:00'));
                } else {
                    // Use shared dates for all cottages
                    cottageDates = dates;
                }
                
                if (cottageDates.length === 0) return;
                
                // Count nights per season for this cottage
                const seasonCounts = { spring: 0, summer: 0, fall: 0, winter: 0 };
                for (let i = 0; i < cottageDates.length - 1; i++) {
                    const season = getSeason(cottageDates[i]);
                    seasonCounts[season]++;
                }
                
                cottageNights = cottageDates.length > 1 ? cottageDates.length - 1 : 1;
                
                breakdownHTML += `<div style="margin-bottom: 15px; padding: 15px; background: rgba(79, 172, 254, 0.05); border-radius: 8px; border-left: 3px solid #4facfe;">`;
                breakdownHTML += `<strong style="font-size: 1.1rem; color: var(--primary-color);">${cottage.name}</strong>`;
                
                // Show date range for individual mode
                if (multipleCottageMode === 'individual' && cottageDates.length > 0) {
                    const firstDate = cottageDates[0].toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    const lastDate = cottageDates[cottageDates.length - 1].toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    breakdownHTML += ` <span style="font-size: 0.9rem; font-weight: normal; opacity: 0.8;">(${firstDate} ‚Üí ${lastDate})</span>`;
                }
                breakdownHTML += `<br>`;
                
                // Calculate price for each season that has nights
                for (const season in seasonCounts) {
                    if (seasonCounts[season] > 0) {
                        const nights = seasonCounts[season];
                        const pricePerNight = cottage.pricing[season];
                        const seasonTotal = pricePerNight * nights;
                        cottageTotal += seasonTotal;
                        
                        cottageDetails.push(
                            `${seasonEmojis[season]} ${seasonNames[season]}: $${pricePerNight} √ó ${nights} night${nights !== 1 ? 's' : ''} = $${seasonTotal}`
                        );
                    }
                }
                
                breakdownHTML += `<div style="margin: 8px 0 8px 15px; line-height: 1.8; color: #555;">${cottageDetails.join('<br>')}</div>`;
                breakdownHTML += `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd; font-weight: 600; color: #333;">Cottage Subtotal: $${cottageTotal}</div>`;
                breakdownHTML += `</div>`;
                
                totalPrice += cottageTotal;
                
                // For guest charges, use the longest stay if individual mode
                if (cottageNights > totalNights) {
                    totalNights = cottageNights;
                }
            });
            
            // If not individual mode or combining for final, use the overall dates
            if (multipleCottageMode !== 'individual' || currentCottageIndex >= selectedCottages.length) {
                totalNights = dates.length > 1 ? dates.length - 1 : 1;
            }
            
            // Add guest charges
            const guestChargesPerNight = (numAdults * ADULT_RATE) + (numChildren * CHILD_RATE) + (numPets * PET_RATE);
            const totalGuestCharges = guestChargesPerNight * totalNights;
            
            if (guestChargesPerNight > 0) {
                breakdownHTML += `<div style="margin-bottom: 15px; padding: 15px; background: rgba(76, 175, 80, 0.05); border-radius: 8px; border-left: 3px solid #4caf50;">`;
                breakdownHTML += `<strong style="font-size: 1.1rem; color: #4caf50;">Guest Charges</strong><br>`;
                breakdownHTML += `<div style="margin: 8px 0 8px 15px; line-height: 1.8; color: #555;">`;
                
                if (numAdults > 0) breakdownHTML += `üë§ ${numAdults} Adult${numAdults !== 1 ? 's' : ''} √ó $${ADULT_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numAdults * ADULT_RATE * totalNights}<br>`;
                if (numChildren > 0) breakdownHTML += `üë∂ ${numChildren} Child${numChildren !== 1 ? 'ren' : ''} √ó $${CHILD_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numChildren * CHILD_RATE * totalNights}<br>`;
                if (numPets > 0) breakdownHTML += `üêæ ${numPets} Pet${numPets !== 1 ? 's' : ''} √ó $${PET_RATE} √ó ${totalNights} night${totalNights !== 1 ? 's' : ''} = $${numPets * PET_RATE * totalNights}<br>`;
                
                breakdownHTML += `</div>`;
                breakdownHTML += `<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd; font-weight: 600; color: #333;">Guest Subtotal: $${totalGuestCharges}</div>`;
                breakdownHTML += `</div>`;
                
                totalPrice += totalGuestCharges;
            }
            
            // Calculate subtotal before tax
            const subtotal = totalPrice;
            
            // Add Meals & Rooms Tax (8.5%)
            const taxRate = 0.085;
            const taxAmount = subtotal * taxRate;
            totalPrice += taxAmount;
            
            // Add tax breakdown
            breakdownHTML += `<div style="margin-bottom: 15px; padding: 15px; background: rgba(255, 152, 0, 0.05); border-radius: 8px; border-left: 3px solid #ff9800;">`;
            breakdownHTML += `<strong style="font-size: 1.1rem; color: #ff9800;">Taxes & Fees</strong><br>`;
            breakdownHTML += `<div style="margin: 8px 0 8px 15px; line-height: 1.8; color: #555;">`;
            breakdownHTML += `üìã Subtotal: $${subtotal.toFixed(2)}<br>`;
            breakdownHTML += `üèõÔ∏è Meals & Rooms Tax (8.5%): $${taxAmount.toFixed(2)}`;
            breakdownHTML += `</div>`;
            breakdownHTML += `</div>`;
            
            priceDisplay.style.display = 'block';
            breakdown.innerHTML = breakdownHTML;
            total.textContent = `$${totalPrice.toFixed(2)}`;
        }
        
        // Get season from date
        function getSeason(date) {
            const month = date.getMonth() + 1; // 1-12
            
            if (month >= 3 && month <= 5) return 'spring';     // Mar-May
            if (month >= 6 && month <= 8) return 'summer';     // Jun-Aug
            if (month >= 9 && month <= 11) return 'fall';      // Sep-Nov
            return 'winter';                                    // Dec-Feb
        }
        
        // Calendar navigation
        function previousMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        }
        
        // Clear date selection
        function clearDateSelection() {
            selectedStartDate = null;
            selectedEndDate = null;
            selectedDateSet = new Set();
            renderCalendar();
            updateSelectedDatesDisplay();
        }
    </script>
</body>
</html>
